<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 15">
<meta name=Originator content="Microsoft Word 15">
<link rel=File-List href="archlinux-habr-habr.files/filelist.xml">
<link rel=Edit-Time-Data href="archlinux-habr-habr.files/editdata.mso">
<!--[if !mso]>
<style>
v\:* {behavior:url(#default#VML);}
o\:* {behavior:url(#default#VML);}
w\:* {behavior:url(#default#VML);}
.shape {behavior:url(#default#VML);}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>Doctor_Who</o:Author>
  <o:LastAuthor>Doctor_Who</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>1</o:TotalTime>
  <o:LastPrinted>2019-07-21T23:32:00Z</o:LastPrinted>
  <o:Created>2019-07-21T23:32:00Z</o:Created>
  <o:LastSaved>2019-07-21T23:32:00Z</o:LastSaved>
  <o:Pages>43</o:Pages>
  <o:Words>11989</o:Words>
  <o:Characters>68340</o:Characters>
  <o:Company>diakov.net</o:Company>
  <o:Lines>569</o:Lines>
  <o:Paragraphs>160</o:Paragraphs>
  <o:CharactersWithSpaces>80169</o:CharactersWithSpaces>
  <o:Version>15.00</o:Version>
 </o:DocumentProperties>
 <o:OfficeDocumentSettings>
  <o:AllowPNG/>
 </o:OfficeDocumentSettings>
</xml><![endif]-->
<link rel=themeData href="archlinux-habr-habr.files/themedata.thmx">
<link rel=colorSchemeMapping
href="archlinux-habr-habr.files/colorschememapping.xml">
<!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:GrammarState>Clean</w:GrammarState>
  <w:TrackMoves>false</w:TrackMoves>
  <w:TrackFormatting/>
  <w:PunctuationKerning/>
  <w:ValidateAgainstSchemas/>
  <w:SaveIfXMLInvalid>false</w:SaveIfXMLInvalid>
  <w:IgnoreMixedContent>false</w:IgnoreMixedContent>
  <w:AlwaysShowPlaceholderText>false</w:AlwaysShowPlaceholderText>
  <w:DoNotPromoteQF/>
  <w:LidThemeOther>RU</w:LidThemeOther>
  <w:LidThemeAsian>X-NONE</w:LidThemeAsian>
  <w:LidThemeComplexScript>X-NONE</w:LidThemeComplexScript>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
   <w:UseWord2010TableStyleRules/>
   <w:DontGrowAutofit/>
   <w:DontUseIndentAsNumberingTabStop/>
   <w:FELineBreak11/>
   <w:WW11IndentRules/>
   <w:DontAutofitConstrainedTables/>
   <w:AutofitLikeWW11/>
   <w:HangulWidthLikeWW11/>
   <w:UseNormalStyleForList/>
   <w:DontVertAlignCellWithSp/>
   <w:DontBreakConstrainedForcedTables/>
   <w:DontVertAlignInTxbx/>
   <w:Word11KerningPairs/>
   <w:CachedColBalance/>
  </w:Compatibility>
  <m:mathPr>
   <m:mathFont m:val="Cambria Math"/>
   <m:brkBin m:val="before"/>
   <m:brkBinSub m:val="&#45;-"/>
   <m:smallFrac m:val="off"/>
   <m:dispDef/>
   <m:lMargin m:val="0"/>
   <m:rMargin m:val="0"/>
   <m:defJc m:val="centerGroup"/>
   <m:wrapIndent m:val="1440"/>
   <m:intLim m:val="subSup"/>
   <m:naryLim m:val="undOvr"/>
  </m:mathPr></w:WordDocument>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:LatentStyles DefLockedState="false" DefUnhideWhenUsed="false"
  DefSemiHidden="false" DefQFormat="false" DefPriority="99"
  LatentStyleCount="371">
  <w:LsdException Locked="false" Priority="0" QFormat="true" Name="Normal"/>
  <w:LsdException Locked="false" Priority="9" QFormat="true" Name="heading 1"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 2"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 3"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 4"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 5"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 6"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 7"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 8"/>
  <w:LsdException Locked="false" Priority="9" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="heading 9"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index 9"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 1"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 2"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 3"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 4"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 5"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 6"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 7"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 8"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" Name="toc 9"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Normal Indent"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="footnote text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="annotation text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="header"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="footer"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="index heading"/>
  <w:LsdException Locked="false" Priority="35" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="caption"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="table of figures"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="envelope address"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="envelope return"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="footnote reference"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="annotation reference"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="line number"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="page number"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="endnote reference"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="endnote text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="table of authorities"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="macro"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="toa heading"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Bullet"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Number"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Bullet 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Bullet 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Bullet 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Bullet 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Number 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Number 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Number 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Number 5"/>
  <w:LsdException Locked="false" Priority="10" QFormat="true" Name="Title"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Closing"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Signature"/>
  <w:LsdException Locked="false" Priority="1" SemiHidden="true"
   UnhideWhenUsed="true" Name="Default Paragraph Font"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text Indent"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Continue"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Continue 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Continue 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Continue 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="List Continue 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Message Header"/>
  <w:LsdException Locked="false" Priority="11" QFormat="true" Name="Subtitle"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Salutation"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Date"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text First Indent"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text First Indent 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Note Heading"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text Indent 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Body Text Indent 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Block Text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Hyperlink"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="FollowedHyperlink"/>
  <w:LsdException Locked="false" Priority="22" QFormat="true" Name="Strong"/>
  <w:LsdException Locked="false" Priority="20" QFormat="true" Name="Emphasis"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Document Map"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Plain Text"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="E-mail Signature"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Top of Form"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Bottom of Form"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Normal (Web)"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Acronym"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Address"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Cite"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Code"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Definition"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Keyboard"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Preformatted"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Sample"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Typewriter"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="HTML Variable"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Normal Table"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="annotation subject"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="No List"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Outline List 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Outline List 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Outline List 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Simple 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Classic 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Colorful 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Columns 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Grid 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 4"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 5"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 6"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 7"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table List 8"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table 3D effects 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Contemporary"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Elegant"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Professional"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Subtle 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 1"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 2"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Web 3"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Balloon Text"/>
  <w:LsdException Locked="false" Priority="39" Name="Table Grid"/>
  <w:LsdException Locked="false" SemiHidden="true" UnhideWhenUsed="true"
   Name="Table Theme"/>
  <w:LsdException Locked="false" SemiHidden="true" Name="Placeholder Text"/>
  <w:LsdException Locked="false" Priority="1" QFormat="true" Name="No Spacing"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 1"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 1"/>
  <w:LsdException Locked="false" SemiHidden="true" Name="Revision"/>
  <w:LsdException Locked="false" Priority="34" QFormat="true"
   Name="List Paragraph"/>
  <w:LsdException Locked="false" Priority="29" QFormat="true" Name="Quote"/>
  <w:LsdException Locked="false" Priority="30" QFormat="true"
   Name="Intense Quote"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 1"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 1"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 1"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 1"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 1"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 2"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 2"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 2"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 2"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 2"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 2"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 3"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 3"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 3"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 3"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 3"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 3"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 4"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 4"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 4"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 4"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 4"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 4"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 5"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 5"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 5"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 5"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 5"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 5"/>
  <w:LsdException Locked="false" Priority="60" Name="Light Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="61" Name="Light List Accent 6"/>
  <w:LsdException Locked="false" Priority="62" Name="Light Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="63" Name="Medium Shading 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="64" Name="Medium Shading 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="65" Name="Medium List 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="66" Name="Medium List 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="67" Name="Medium Grid 1 Accent 6"/>
  <w:LsdException Locked="false" Priority="68" Name="Medium Grid 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="69" Name="Medium Grid 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="70" Name="Dark List Accent 6"/>
  <w:LsdException Locked="false" Priority="71" Name="Colorful Shading Accent 6"/>
  <w:LsdException Locked="false" Priority="72" Name="Colorful List Accent 6"/>
  <w:LsdException Locked="false" Priority="73" Name="Colorful Grid Accent 6"/>
  <w:LsdException Locked="false" Priority="19" QFormat="true"
   Name="Subtle Emphasis"/>
  <w:LsdException Locked="false" Priority="21" QFormat="true"
   Name="Intense Emphasis"/>
  <w:LsdException Locked="false" Priority="31" QFormat="true"
   Name="Subtle Reference"/>
  <w:LsdException Locked="false" Priority="32" QFormat="true"
   Name="Intense Reference"/>
  <w:LsdException Locked="false" Priority="33" QFormat="true" Name="Book Title"/>
  <w:LsdException Locked="false" Priority="37" SemiHidden="true"
   UnhideWhenUsed="true" Name="Bibliography"/>
  <w:LsdException Locked="false" Priority="39" SemiHidden="true"
   UnhideWhenUsed="true" QFormat="true" Name="TOC Heading"/>
  <w:LsdException Locked="false" Priority="41" Name="Plain Table 1"/>
  <w:LsdException Locked="false" Priority="42" Name="Plain Table 2"/>
  <w:LsdException Locked="false" Priority="43" Name="Plain Table 3"/>
  <w:LsdException Locked="false" Priority="44" Name="Plain Table 4"/>
  <w:LsdException Locked="false" Priority="45" Name="Plain Table 5"/>
  <w:LsdException Locked="false" Priority="40" Name="Grid Table Light"/>
  <w:LsdException Locked="false" Priority="46" Name="Grid Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="Grid Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="Grid Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="Grid Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="Grid Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="Grid Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="Grid Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="Grid Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="Grid Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="Grid Table 7 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="46" Name="List Table 1 Light"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark"/>
  <w:LsdException Locked="false" Priority="51" Name="List Table 6 Colorful"/>
  <w:LsdException Locked="false" Priority="52" Name="List Table 7 Colorful"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 1"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 1"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 1"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 1"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 1"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 1"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 2"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 2"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 2"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 2"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 2"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 2"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 3"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 3"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 3"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 3"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 3"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 3"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 4"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 4"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 4"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 4"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 4"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 4"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 5"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 5"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 5"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 5"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 5"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 5"/>
  <w:LsdException Locked="false" Priority="46"
   Name="List Table 1 Light Accent 6"/>
  <w:LsdException Locked="false" Priority="47" Name="List Table 2 Accent 6"/>
  <w:LsdException Locked="false" Priority="48" Name="List Table 3 Accent 6"/>
  <w:LsdException Locked="false" Priority="49" Name="List Table 4 Accent 6"/>
  <w:LsdException Locked="false" Priority="50" Name="List Table 5 Dark Accent 6"/>
  <w:LsdException Locked="false" Priority="51"
   Name="List Table 6 Colorful Accent 6"/>
  <w:LsdException Locked="false" Priority="52"
   Name="List Table 7 Colorful Accent 6"/>
 </w:LatentStyles>
</xml><![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
@font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;
	mso-font-charset:1;
	mso-generic-font-family:roman;
	mso-font-format:other;
	mso-font-pitch:variable;
	mso-font-signature:0 0 0 0 0 0;}
@font-face
	{font-family:"Calibri Light";
	panose-1:2 15 3 2 2 2 4 3 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-1610611985 1073750139 0 0 415 0;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;
	mso-font-charset:204;
	mso-generic-font-family:swiss;
	mso-font-pitch:variable;
	mso-font-signature:-520092929 1073786111 9 0 415 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-parent:"";
	margin-top:0cm;
	margin-right:0cm;
	margin-bottom:8.0pt;
	margin-left:0cm;
	line-height:107%;
	mso-pagination:widow-orphan;
	font-size:11.0pt;
	font-family:"Calibri",sans-serif;
	mso-fareast-font-family:Calibri;
	mso-bidi-font-family:"Times New Roman";
	mso-fareast-language:EN-US;}
h1
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Заголовок 1 Знак";
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:24.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:"Times New Roman";}
h2
	{mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-qformat:yes;
	mso-style-link:"Заголовок 2 Знак";
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	mso-outline-level:2;
	font-size:18.0pt;
	font-family:"Times New Roman",serif;
	mso-fareast-font-family:"Times New Roman";}
h3
	{mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-qformat:yes;
	mso-style-link:"Заголовок 3 Знак";
	mso-style-next:Обычный;
	margin-top:2.0pt;
	margin-right:0cm;
	margin-bottom:0cm;
	margin-left:0cm;
	margin-bottom:.0001pt;
	line-height:107%;
	mso-pagination:widow-orphan lines-together;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:12.0pt;
	font-family:"Calibri Light",sans-serif;
	mso-fareast-font-family:"Times New Roman";
	color:#1F4D78;
	mso-fareast-language:EN-US;
	font-weight:normal;}
a:link, span.MsoHyperlink
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{mso-style-noshow:yes;
	mso-style-priority:99;
	color:#954F72;
	mso-themecolor:followedhyperlink;
	text-decoration:underline;
	text-underline:single;}
code
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";}
pre
	{mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-link:"Стандартный HTML Знак";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.1
	{mso-style-name:"Заголовок 1 Знак";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-parent:"";
	mso-style-link:"Заголовок 1";
	mso-ansi-font-size:24.0pt;
	mso-bidi-font-size:24.0pt;
	font-family:"Times New Roman",serif;
	mso-ascii-font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	mso-font-kerning:18.0pt;
	mso-fareast-language:RU;
	font-weight:bold;}
span.2
	{mso-style-name:"Заголовок 2 Знак";
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-parent:"";
	mso-style-link:"Заголовок 2";
	mso-ansi-font-size:18.0pt;
	mso-bidi-font-size:18.0pt;
	font-family:"Times New Roman",serif;
	mso-ascii-font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Times New Roman";
	mso-bidi-font-family:"Times New Roman";
	mso-fareast-language:RU;
	font-weight:bold;}
span.posttitle-text
	{mso-style-name:post__title-text;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.HTML
	{mso-style-name:"Стандартный HTML Знак";
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-parent:"";
	mso-style-link:"Стандартный HTML";
	mso-ansi-font-size:10.0pt;
	mso-bidi-font-size:10.0pt;
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";
	mso-fareast-language:RU;}
span.hljs-string
	{mso-style-name:hljs-string;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-builtin
	{mso-style-name:hljs-built_in;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-variable
	{mso-style-name:hljs-variable;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-keyword
	{mso-style-name:hljs-keyword;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-literal
	{mso-style-name:hljs-literal;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-comment
	{mso-style-name:hljs-comment;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-title
	{mso-style-name:hljs-title;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.hljs-meta
	{mso-style-name:hljs-meta;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.3
	{mso-style-name:"Заголовок 3 Знак";
	mso-style-noshow:yes;
	mso-style-priority:9;
	mso-style-unhide:no;
	mso-style-locked:yes;
	mso-style-parent:"";
	mso-style-link:"Заголовок 3";
	mso-ansi-font-size:12.0pt;
	mso-bidi-font-size:12.0pt;
	font-family:"Calibri Light",sans-serif;
	mso-ascii-font-family:"Calibri Light";
	mso-fareast-font-family:"Times New Roman";
	mso-hansi-font-family:"Calibri Light";
	mso-bidi-font-family:"Times New Roman";
	color:#1F4D78;}
span.posttype-label
	{mso-style-name:post__type-label;
	mso-style-unhide:no;
	mso-style-parent:"";}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
.MsoChpDefault
	{mso-style-type:export-only;
	mso-default-props:yes;
	font-family:"Calibri",sans-serif;
	mso-ascii-font-family:Calibri;
	mso-fareast-font-family:Calibri;
	mso-hansi-font-family:Calibri;}
@page WordSection1
	{size:595.3pt 841.9pt;
	margin:2.0cm 42.5pt 2.0cm 3.0cm;
	mso-header-margin:35.4pt;
	mso-footer-margin:35.4pt;
	mso-paper-source:0;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 @list l0
	{mso-list-id:2708040;
	mso-list-template-ids:-1483684946;}
@list l0:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level2
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l0:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1
	{mso-list-id:240021158;
	mso-list-template-ids:1615635108;}
@list l1:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l1:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l1:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l1:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2
	{mso-list-id:789515748;
	mso-list-template-ids:428247252;}
@list l2:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l2:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l2:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l2:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3
	{mso-list-id:1234974329;
	mso-list-template-ids:195604002;}
@list l3:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l3:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l3:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l3:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4
	{mso-list-id:1294673157;
	mso-list-template-ids:-153833892;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l4:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l4:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l4:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5
	{mso-list-id:1373383883;
	mso-list-template-ids:1716175840;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l5:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l5:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l5:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l6
	{mso-list-id:1635059170;
	mso-list-template-ids:-1386167426;}
@list l6:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level2
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l6:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l7
	{mso-list-id:1651669761;
	mso-list-template-ids:1784608900;}
@list l7:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l7:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l7:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l7:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8
	{mso-list-id:1684430695;
	mso-list-template-ids:1647337782;}
@list l8:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l8:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l8:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l8:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l9
	{mso-list-id:1751849789;
	mso-list-template-ids:1441955456;}
@list l9:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level2
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l9:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l10
	{mso-list-id:2095583895;
	mso-list-template-ids:-1584596376;}
@list l10:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l10:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l10:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l10:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11
	{mso-list-id:2123642351;
	mso-list-template-ids:-1642938734;}
@list l11:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:36.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Symbol;}
@list l11:level2
	{mso-level-number-format:bullet;
	mso-level-text:o;
	mso-level-tab-stop:72.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:"Courier New";
	mso-bidi-font-family:"Times New Roman";}
@list l11:level3
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:108.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level4
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:144.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level5
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:180.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level6
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:216.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level7
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:252.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level8
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:288.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
@list l11:level9
	{mso-level-number-format:bullet;
	mso-level-text:\F0A7;
	mso-level-tab-stop:324.0pt;
	mso-level-number-position:left;
	text-indent:-18.0pt;
	mso-ansi-font-size:10.0pt;
	font-family:Wingdings;}
ol
	{margin-bottom:0cm;}
ul
	{margin-bottom:0cm;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Обычная таблица";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-priority:99;
	mso-style-parent:"";
	mso-padding-alt:0cm 5.4pt 0cm 5.4pt;
	mso-para-margin:0cm;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Calibri",sans-serif;
	mso-bidi-font-family:"Times New Roman";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="1026"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=RU link=blue vlink="#954F72" style='tab-interval:35.4pt'>

<div class=WordSection1>

<p class=MsoNormal style='margin-bottom:8.25pt;line-height:normal;mso-outline-level:
1;background:white'><span style='font-size:24.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#343434;mso-font-kerning:18.0pt;
mso-fareast-language:RU'>Разбираемся с установкой и загрузкой Linux на примере
ArchLinux</span><b><span style='font-size:24.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#333333;mso-font-kerning:18.0pt;
mso-fareast-language:RU'><o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l5 level1 lfo1;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973;mso-fareast-language:RU'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#5E6973;mso-fareast-language:
RU'><a href="https://habr.com/ru/hub/linux/" title="Вы не подписаны на этот хаб"><span
style='color:#5E6973'>Настройка Linux</span></a>,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l5 level1 lfo1;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973;mso-fareast-language:RU'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#5E6973;mso-fareast-language:
RU'><a href="https://habr.com/ru/hub/sys_admin/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Системное
администрирование</span></a><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l11 level1 lfo2;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:10.5pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#333333;
mso-fareast-language:RU'><span style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#333333;mso-fareast-language:
RU'><a href="https://habr.com/ru/sandbox/" title="Перейти в песочницу"><span
style='font-size:9.0pt;color:#6667A3;position:relative;top:1.0pt;mso-text-raise:
-1.0pt'>Из песочницы</span></a><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>Сначала мы установим Archlinux и превратим его в загрузочный сервер. Прямо
оттуда подготовим новую компактную систему, в которую добавим минимальное
графическое окружение и самый необходимый функционал (на примере Firefox).
Научим нашу систему загружаться по сети даже на компьютерах с UEFI. Затем
полностью переведём её в режим «только для чтения» (сделаем «живой»), что
позволит нам использовать систему одновременно хоть на пол сотне разномастных
компьютеров с одним единственным загрузочным сервером. Это всё будет работать
даже внутри дешёвой 100-Мб сети, которую мы дополнительно «разгоним» в пару
раз.<br>
<br>
Никакие закладки в жестких дисках будут вам не страшны, потому что дисков у нас
не будет. Никакие очумелые ручки пользователей ничего не сломают, т. к. после
перезагрузки система вернется в первозданное лично вами состояние. Конечно же,
вы научитесь и сможете самостоятельно изменять загружаемую систему таким
образом, чтобы в ней содержался только нужный вам функционал и ничего лишнего.
Между делом мы выясним, как и в каком порядке загружается Linux, а также из
чего он состоит. Знания, как известно, — бесценны, поэтому я делюсь ими даром.<br>
<br>
Постараюсь без долгих рассуждений пояснять происходящее, иногда забегая немного
вперёд, но впоследствии обязательно раскладывая всё по полочкам. Чтобы у вас
вообще не возникало проблем с пониманием, предполагаю, что вы уже работали с
каким-нибудь готовым дистрибутивом Linux, пробовали писать простые скрипты с
помощью nano или другого текстового редактора. Если вы новичок в ArchLinux, то
узнаете много нового, а если «старичок», то узнаете поменьше, но, надеюсь, что
в любом случае вы ещё сильнее полюбите Linux.<br>
<br>
Информации оказалось очень много. И по устоявшейся голливудской традиции
впереди вас ждёт сериал в нескольких <span class=GramE>частях:<br>
<a href="http://habrahabr.ru/post/253573/"><span style='color:#992298'>продолжение</span></a></span>;<br>
<a href="http://habrahabr.ru/post/254415/"><span style='color:#992298'>окончание</span></a>.<br>
<br>
Сейчас мы установим Archlinux в VirtualBox, который можно будет клонировать и
запускать практически на любом компьютере с legacy BIOS без каких-либо
дополнительных настроек. Между делом мы познакомимся с основными приёмами
работы с systemd, а также <span class=GramE>узнаем</span> как его использовать
для запуска произвольных служб и программ во время загрузки. Ещё мы увидим,
какие этапы проходит Linux при загрузке, и напишем собственный обработчик
(hook), который поместим в initramfs. Не <span class=GramE>знаете</span> что
такое initramfs? Тогда заходите под кат.<br>
<a name=habracut></a><br>
Есть много причин, по которым выбор пал именно на Archlinux. Первая причина: он
мой давний изворотливый приятель и верный помощник. Gentoo, как пишут на
просторах Интернета, ещё более изворотлив, но собирать систему из исходников не
хочется. Вторая причина: в готовых сборках всегда содержится много лишнего, а
перекачивание больших объемов данных может критично сказаться на
производительности сети, да и ничего не видно за широкой спиной
«автоматического инсталлятора» — это третья причина. Четвертая: systemd
постепенно проникает во все дистрибутивы и&nbsp;<a
href="http://http/habrahabr.ru/post/240839/"><span style='color:#992298'>даже в
Debian</span></a>, так что мы сможем хорошенько покопаться в грядущем готовых
дистрибутивов на примере Archlinux. При всём при этом, систему, которую мы позднее
подготовим, можно будет загружать по сети не только сервера, работающего в
виртуальной машине, но и с обычного компьютера, например, с Raspberry Pi, и
даже с Western Digital My Cloud (проверено), который работает под Debian.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Подготовительные работы<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Скачиваем свежий образ по ссылке с&nbsp;<a
href="https://www.archlinux.org/download/"><span style='color:#992298'>официального
сайта</span></a>. В Москве с серверов Яндекса, например, загрузка происходит
очень быстро, <span class=GramE>и</span> если у вас процесс затянулся — просто
попробуйте качать в другом месте. Рекомендую запомнить в каком, т. к. эта
информация нам ещё пригодится.<br>
<br>
В VirtualBox создаем новую виртуальную машину (например, с 1 Гб оперативной
памяти и 8 Гб накопителем). В настройках сети необходимо выбрать тип
подключения «сетевой мост» и подходящий сетевой адаптер с доступом к сети
Интернет. Подключаем скаченный образ к CD-ROM'у. Если не терпится начать
работать с железом, то берите флешку и записывайте образ с помощью&nbsp;<a
href="http://sourceforge.net/projects/win32diskimager"><span style='color:#992298'>Win32
Disk Imager</span></a>&nbsp;(если работаете под Windows), а потом загружайте
будущий сервер прямо с неё.<br>
<br>
Включаем машину, дожидаемся появления командной строки и устанавливаем пароль,
без которого SSH работать не будет:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>passwd</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Запускаем сервер SSH командой:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>systemctl start sshd</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Остается узнать IP адрес машины, изучив вывод команды:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>ip</span></span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'> addr | grep </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>&quot;scope global&quot;</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Адрес будет указан сразу после «inet<span class=GramE>».<br>
<br>
Теперь</span> пользователи Windows смогут подключиться к машине с помощью&nbsp;<a
href="http://www.putty.org/"><span style='color:#992298'>putty</span></a>, а
потом будут копировать отсюда команды и вставлять их и нажатием правой кнопки
мыши.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Базовая установка<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Дальше максимально коротко опишу стандартную установку Archlinux. Если появятся
вопросы, то ответы на них вы, вероятно, найдете в&nbsp;<a
href="https://wiki.archlinux.org/index.php/Beginners%27_guide"><span
style='color:#992298'>Подробном описании установки для новичков</span></a>.
Wiki просто замечательная, а англоязычная wiki даже актуальная, так что
старайтесь пользоваться именно ей.<br>
<br>
Подготавливаем носитель с помощью cfdisk (это консольная утилита с простым и
понятным интерфейсом). Нам достаточно одного раздела, только не забудьте
пометить его как загрузочный:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>cfdisk /dev/sda</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Форматируем в ext4 и устанавливаем метку, <span class=GramE>например</span>
HABR:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>mkfs.ext4
/dev/sda1 -L </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>&quot;HABR&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Будущий корневой раздел монтируем в /mnt:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#C18401;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>export</span></span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'> root=/mnt<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>mount</span></span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'> /dev/sda1 </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:12.0pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#222222;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Archlinux обычно устанавливается через интернет, поэтому сразу после установки
у вас будет самая новая и актуальная версия. Список репозиториев находится в
файле /etc/pacman.d/mirrorlist. Постарайтесь вспомнить, откуда скачивали
дистрибутив и перенесите эти серверы в самое начало списка — так вы серьезно
сэкономите время на следующем шаге. Обычно это серверы, географически
расположенные там же, где вы сейчас находитесь.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nano /etc/pacman.d/mirrorlist</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Устанавливаем базовый набор пакетов и набор для разработчиков:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>pacstrap</span></span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'> -i </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'> base
base-devel</span><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Теперь воспользуемся командой arch-chroot, которая позволяет временно подменить
корневой каталог на любой другой, в котором есть структура корневой файловой
системы Linux. При этом программы, которые мы оттуда запустим, не будут знать о
том, что снаружи ещё что-то существует. Мы практически окажемся в нашей новой
системе с правами администратора:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>arch-chroot </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Обратите внимание, как поменялось приглашение командной строки.<br>
<br>
Выбираем языки, которые планируем использовать. Предлагаю оставить en_US.UTF-8
UTF-8 и ru_RU.UTF-8 UTF-8. В текстовом редакторе нужно просто снять комментарии
напротив них:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nano /etc/locale.gen</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Теперь генерируем выбранные локализации:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>locale-gen</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Если всё прошло хорошо, то вы увидите примерно такой текст:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Generating
locales...<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>  </span><span class=GramE>en_US.UTF-8</span>... </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#A626A4;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>done</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>  </span><span class=GramE>ru_RU.UTF-8</span>... </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#A626A4;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>done</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Generation
complete.</span><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Устанавливаем язык, который будет использоваться по-умолчанию:&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#C18401;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>echo</span></span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>
LANG=ru_RU.UTF-8 &gt; /etc/locale.conf</span><span lang=EN-US style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
А также раскладку и шрифт в консоли:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>echo</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> -e </span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>&quot;KEYMAP=ru\nFONT=cyr-sun16\nFONT_MAP=&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> &gt; /etc/vconsole.conf</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Указываем часовой пояс (я использую московское время):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ln -s
/usr/share/zoneinfo/Europe/Moscow /etc/localtime</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Придумываем название для нашего будущего сервера:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-fareast-language:RU'>echo</span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-fareast-language:RU'>&quot;HabraBoot<span
class=GramE>&quot;<span style='color:#383A42'> &gt;</span></span></span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> /etc/hostname</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Теперь установим пароль администратора. Делаем мы это в первую очередь из-за
того, что SSH не позволит нам подключиться к системе без пароля. Тему
неразумности использования системы, незащищенной паролем, здесь мы развивать не
будем.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>passwd</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Дважды вводим пароль и убеждаемся, что&nbsp;<b>password updated successfully</b>.<br>
<br>
Добавим нового пользователя с именем&nbsp;<i>username</i>&nbsp;(можете выбрать
любое), наделим его правами администратора и зададим ему пароль из тех же
соображений, а ещё и из-за того, что под root в текущей версии Arch мы не
сможем собирать пакеты из AUR (Arch User Repository — это репозиторий от
сообщества пользователей Arch Linux с программами, которые не вошли в основной
репозиторий):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>useradd -m username</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Редактируем файл настроек /etc/sudoers с помощью nano:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>EDITOR=nano visudo</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Добавив в него сразу после строки «root ALL=(ALL) ALL» ещё одну строчку:&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>username ALL=(ALL) ALL</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
И задаём пароль для пользователя username:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>passwd username</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Теперь нужно установить загрузчик на внутренний накопитель, чтобы система
смогла самостоятельно с него загрузиться. В качестве загрузчика предлагаю
использовать GRUB, потому что позже он нам снова пригодится. Устанавливаем
пакеты с помощью стандартного для Archlinux менеджера пакетов pacman:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>pacman -S grub</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Записываем загрузчик в MBR (Master Boot Record) нашего внутреннего накопителя.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>grub-install
--target=i386-pc --force --recheck /dev/sda</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Если всё прошло нормально, то вы увидите&nbsp;<b>Installation finished. No
error reported</b>.<br>
<br>
Выходим из chroot:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-fareast-language:RU'>exit</span><span style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
И замечаем, как поменялось приглашение командной строки.<br>
<br>
Мы будем использовать метки дисков, подробное объяснение этого утверждения
последует позже.<br>
<br>
Снимите комментарий со строки&nbsp;<b>GRUB_DISABLE_LINUX_UUID=true</b>, чтобы
не использовались UUID накопителей:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nano </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/default/grub</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Генерируем файл конфигурации загрузчика, снова используя arch-chroot. Будет
произведён вход, выполнение одной единственной команды, и последует
автоматический выход:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>arch-chroot
</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> grub-mkconfig --output=/boot/grub/grub.cfg</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Нам нужно заменить все упоминания&nbsp;<b>/dev/sda1</b>&nbsp;на&nbsp;<b>LABEL=HABR</b>&nbsp;в
файле конфигурации:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>mv </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/boot/grub/grub.cfg </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/boot/grub/grub.cfg.autoconf
&amp;<span class=GramE>&amp;<span style='mso-spacerun:yes'>  </span>cat</span> </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/boot/grub/grub.cfg.autoconf
| sed </span><span style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#50A14F;background:#FBFDFF;
mso-fareast-language:RU'>'s/\(root=\)\/dev\/sda1/\1LABEL=HABR/g'</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> &gt; </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/boot/grub/grub.cfg</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Если поменять в этом же файле строку&nbsp;<b>set lang=en_US</b>&nbsp;на&nbsp;<b>set
lang=ru_RU</b>, то загрузчик будет общаться с нами на великом и могучем.<br>
<br>
Генерируем файл fstab с ключом -L, который заставит генератор использовать
метки дисков:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>genfstab -p
-L </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> &gt; </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>/etc/fstab</span><span lang=EN-US style='font-size:12.0pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
На этом базовая установка ArchLinux закончена. Система будет загружаться
самостоятельно и встретит вас приветливым русскоязычным интерфейсом командной
строки. Если после этого мы введем команду dhcpcd, то скорее всего даже
Интернет заработает. Но мы пока не будем торопиться с перезагрузкой.&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Запуск при загрузке с помощью systemd на
примере NTP и SSH<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Поскольку наша система будет общаться с другими компьютерами, нам потребуется
синхронизировать время. Если время на сервере и клиенте будет отличаться, то
существует большая вероятность того, что они вообще не смогут соединиться друг
с другом. В свою очередь sudo может начать просить пароль после каждого
действия, думая, что таймаут авторизации давно истёк. И кто знает, с чем нам
ещё предстоит столкнуться? Перестрахуемся.<br>
<br>
Чтобы синхронизировать время с серверами через Интернет по протоколу NTP, нам
нужно установить недостающие пакеты. Можно воспользоваться arch-root, <span
class=GramE>но</span> но мы обойдёмся ключами, которые сообщат новое место для
установки менеджеру пакетов:&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>pacman
--root </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> --dbpath </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>/var/lib/pacman -S ntp</span><span lang=EN-US style='font-size:12.0pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#222222;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Настроим получение точного времени с российских серверов:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>mv </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/ntp.conf </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/ntp.conf.old
&amp;&amp; cat </span><span style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-fareast-language:RU'>$root</span><span style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>/etc/ntp.conf.old | sed </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-fareast-language:RU'>'s/\([0-9]\<span
class=GramE>).*</span>\(.pool.ntp.org\)/\1.ru\2/g'</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> | tee </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/ntp.conf</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Нам достаточно синхронизировать время один раз при загрузке. Раньше мы бы
записали запуск службы точного времени в файл rc.local, но сейчас появился
менеджер системы и служб systemd, который старается запускать службы (в
оригинале они называются unit) параллельно для уменьшения времени загрузки
системы. Естественно, что работоспособность одной службы может зависеть от
функционирования другой. Например, нам бесполезно пытаться синхронизировать
время через Интернет до того, как у нас на компьютере заработает сеть. Чтобы
описать все эти взаимосвязи, уже недостаточно простого указания имени
исполняемого файла, поэтому запуск посредством systemd стал весьма
нетривиальным занятием. Для этой цели были созданы специальные файлы с
расширением <span class=GramE>&quot;.service</span>&quot;. В них указаны
зависимости, имена исполняемых файлов и другие параметры, которые нужно
учитывать для успешного запуска. В частности, для управления этапами загрузки в
systemd используются цели (target), которые по возлагаемым на них задачам схожи
с уровнями запуска (runlevel). Подробности читайте в&nbsp;<a
href="https://wiki.archlinux.org/index.php/systemd"><span style='color:#992298'>вики</span></a>.<br>
<br>
К радости новичков, вместе с пакетом ntp поставляется уже готовый
ntpdate.service. Все файлы, описывающие запуск служб, находятся в папке
$root/usr/lib/systemd/system/, и их можно открыть в любом текстовом редакторе
или посмотреть обычным образом. Вот</span><span lang=EN-US style='font-size:
12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'>, </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>например</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'>, $root/usr/lib/systemd/system/ntpdate.service:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>[Unit]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Description=One-Shot
Network Time Service<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>After=network.target
nss-lookup.target<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Before=ntpd.service<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>[Service]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Type=oneshot<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>PrivateTmp=</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#0184BB;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>true</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ExecStart=/usr/bin/ntpd
-q -n -g -u ntp:ntp<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>[Install]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>WantedBy=multi-user.target</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
В блоке [Unit] в строке Description указывается краткое описание службы, и при
каких условиях она должна быть запущена (в данном случае, после запуска сети,
но до перед запуском сервера NTP, который мы вообще не планируем запускать).
Запрос точного времени происходит единственный раз во время загрузки, и за это
отвечает строка Type=oneshot из блока [Service]. В этом же блоке в строке
ExecStart указаны действия, которые необходимо выполнить для запуска сервиса. В
блоке [Install] в нашем случае указано, что запуск нашей службы необходим для
достижения цели multi-user.target. Рекомендуется использовать такое же
содержание блока [Install] для запуска самодельных служб.<br>
<br>
В качестве первого практического примера мы немного расширим функциональность
ntpdate.service, попросив его дополнительно исправлять время на аппаратных
часах. Если после этого, на этом же самом компьютере вы загрузите Windows, то
увидите время по Гринвичу, так что не пугайтесь.<br>
<br>
Изменение стандартного поведения любой службы systemd производится следующим
образом: сначала в папке /etc/systemd/system/ создается новый каталог с полным
именем службы и расширением <span class=GramE>&quot;.d</span>&quot;, куда добавляется
файл с произвольным именем и расширением &quot;.conf&quot;, и уже там
производятся нужные модификации. Приступим:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>mkdir -p </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/systemd/system/ntpdate.service.d
&amp;&amp; </span><span style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#C18401;background:#FBFDFF;
mso-fareast-language:RU'>echo</span><span style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'> -e </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-fareast-language:RU'>'[Service]\nExecStart=/usr/bin/hwclock
-w<span class=GramE>'<span style='color:#383A42'> &gt;</span></span></span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/systemd/system/ntpdate.service.d/hwclock.conf</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Здесь просто говорится о том, что во сразу после запуска службы выполнить
команду &quot;/usr/bin/hwclock -w&quot;, которая переведёт аппаратные часы.<br>
<br>
Добавляем службу ntpdate в автозагрузку (синтаксис стандартен для всех служб):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>arch-chroot
</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> systemctl </span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>enable</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> ntpdate<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Created
symlink from /etc/systemd/system/multi-user.target.wants/ntpdate.service to
/usr/lib/systemd/system/ntpdate.service.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Как видите, в каталоге multi-user.target.wants создалась обыкновенная
символическая ссылка на файл ntpdate.service, а упоминание о цели
multi-user.target мы видели в блоке [Install] этого самого файла. Получается
для того, чтобы система достигла цели multi-user.target, должны быть запущены
все службы из каталога multi-user.target.wants.<br>
<br>
Теперь устанавливаем пакет SSH аналогичным способом (в ArchLinux он называется
openssh):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>pacman
--root </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> --dbpath </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>/var/lib/pacman -S openssh</span><span lang=EN-US style='font-size:12.0pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#222222;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Но на этот раз для автозапуска мы будем использовать сокет, чтобы сервер SSH
стартовал только после поступления запроса на подключение, а не висел мёртвым
грузом в оперативной памяти:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>arch-chroot
</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> systemctl </span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>enable</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> sshd.socket</span><span lang=EN-US style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Мы не поменяли стандартный 22-й порт и не включили принудительное использование
Protocol 2 — пусть это останется на моей совести.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Забегая вперед или знакомимся с
обработчиками (hooks)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:12.0pt;line-height:normal;background:
white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'><br>
Чтобы мы <span class=GramE>могли</span> не глядя подключиться к нашему будущему
серверу, нам нужно знать его IP адрес. Будет намного проще, если этот адрес —
статический. Обычные способы, о которых говорится <span class=GramE>в вики</span>,
нам не подходят. Проблема в том, что сетевые адаптеры в современном мире
именуются согласно своему физическому расположению на материнской плате.
Например, имя устройства enp0s3 означает, что это сетевой адаптер ethernet,
который расположен на нулевой шине PCI в третьем слоте (подробности&nbsp;<a
href="http://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/"><span
style='color:#992298'>здесь</span></a>). Сделано так для того, чтобы при замене
одного адаптера другим, имя устройства в системе не поменялось. Такое поведение
нам не желательно, т. к. на разных моделях материнских плат положение сетевой
карты может быть разным, и когда мы попытаемся перенести наш загрузочный сервер
из VirtualBox на реальное железо, нам скорее всего придётся загружаться с
клавиатурой и монитором, чтобы правильно настроить сеть. Нам нужно, чтобы имя
сетевого адаптера стало более предсказуемым, например, eth0 (это место
зарезервировано смайликом).<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#548EAA;mso-fareast-language:
RU'>Почему будем делать так?</span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Устанавливаем пакет mkinitcpio-nfs-utils, и у нас появится обработчик (hook)
под названием «net»:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>pacman
--root </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> --dbpath </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>/var/lib/pacman -S mkinitcpio-nfs-utils</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
По-умолчанию, все файлы обработчика попадают в /usr/lib/initcpio/. Обычно это
парные файлы с одинаковым названием, один из которых окажется в подкаталоге
install, а другой — в hooks. Сами файлы являются обычными скриптами. Файл из
папки hooks обычно попадает внутрь файла initramfs (позже мы о нём всё узнаем)
и выполняется при загрузке системы. Второй файл из пары попадает в папку
install. Внутри него есть функция <span class=GramE>build(</span>), в которой
находятся сведения о том, какие действия нужно выполнить во время генерации
файла initramfs, а также функция help() с описанием того, для чего предназначен
данный обработчик. Если запутались, то просто читайте дальше, и всё сказанное в
этом абзаце встанет на свои места.<br>
<br>
Папка initcpio также присутствует в каталоге /etc, и в ней тоже есть
подкаталоги install и hooks. При этом она имеет безусловный приоритет над
/usr/lib/initcpio, т. е. если в обеих папках окажутся файлы с одинаковыми
названиями, то при генерации initcpio будут использоваться файлы из
/etc/initcpio, а не из /usr/lib/initcpio.<br>
<br>
Нам нужно немного поменять функциональность обработчика net, поэтому просто
скопируем файлы из /usr/lib/initcpio в /etc/initcpio:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>cp </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/usr/lib/initcpio/hooks/net
</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>/etc/initcpio/hooks/ &amp;&amp; cp </span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>$root</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>/usr/lib/initcpio/install/net </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/initcpio/install/</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Приводим файл hooks/net к следующему виду:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>cat </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/initcpio/hooks/net<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><i><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'># vim: set ft=sh:</span></i><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#4078F2;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>run_hook</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>() {<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span></span><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A626A4;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>if</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'> [ -n </span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>&quot;</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$ip</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>&quot;</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'> ]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span></span><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A626A4;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>then</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>        </span>ipconfig </span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>&quot;ip=</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>${ip}</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>&quot;</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span></span><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A626A4;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>fi</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#383A42;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>}<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><i><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'># vim: set ft=sh ts=4 sw=4 et:</span></i><span lang=EN-US style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Теперь откроем файл $root/etc/initcpio/install/net и увидим, что в функции <span
class=GramE>help(</span>) отлично написано, что из себя должна представлять
переменная «ip»:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ip=&lt;client-ip&gt;:&lt;server-ip&gt;:&lt;gw-ip&gt;:&lt;netmask&gt;:&lt;hostname&gt;:&lt;device&gt;:&lt;autoconf&gt;</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Останется просто установить значение переменной, чтобы задать статический IP
адрес и название сетевого устройства, например так «192.168.1.100::<span
class=GramE>192.168.1.1:255.255.255.0::</span>eth0:none» (здесь и далее
используйте подходящие для себя настройки сети). В следующем разделе вы
узнаете, где именно задаётся значение.<br>
<br>
А пока уберём всё лишнее из файла $root/etc/initcpio/install/net. Оставляем
загрузку модулей сетевых устройств, программу ipconfig, которую использовали
выше, и, естественно, сам скрипт из папки hooks, выполняющий всю основную
работу. Получится</span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> </span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-fareast-language:RU'>примерно</span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'> </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>следующее</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'>:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>cat </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/initcpio/install/net<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#4078F2;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>#!/bin/bash<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#4078F2;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>build</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>() {<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span>add_checked_modules </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>'/drivers/net/'</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span>add_binary </span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'>&quot;/usr/lib/initcpio/ipconfig&quot;</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>&quot;/bin/ipconfig&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'>    </span>add_runscript<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>}<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#4078F2;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>help</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>() {<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><span
style='mso-spacerun:yes'> </span><span style='mso-spacerun:yes'>   </span>cat
&lt;&lt;HELPEOF<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>This hook
loads necessary modules </span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#A626A4;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>for</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> a network device.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Manually
configures network and freezes network device name.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>HELPEOF<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>}<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><i><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'># vim: set ft=sh ts=4 sw=4 et:</span></i><span lang=EN-US style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Когда во время загрузки менеджер устройств systemd-udevd попробует переименовать
наше сетевое устройство в привычное ему predictable network interface name,
например, в enp0s3, то у него ничего не получится. Почему — читайте дальше.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Как происходит загрузка системы<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Для простоты рассмотрим обычные BIOS. После включения и инициализации, BIOS
начинает по порядку идти по списку загрузочных устройств, пока не найдет
загрузчик, которому передаст дальнейшее управление загрузкой.<br>
<br>
Как раз такой загрузчик мы записали в MBR нашего накопителя. Мы использовали
GRUB, в настройках которого (файл grub.cfg) указали, что корневой раздел
находится на диске с меткой HABR. Вот эта строка целиком:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>linux<span
style='mso-spacerun:yes'>   </span>/boot/vmlinuz-linux root=LABEL=HABR <span
class=GramE>rw<span style='mso-spacerun:yes'>  </span>quiet</span></span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Здесь упомянут файл vmlinuz-linux, который является ядром системы, а указатель
на корневую систему является его параметром. Мы просим искать корневую систему
на устройстве с меткой HABR. Здесь также мог бы быть уникальный для каждого
накопителя UUID, но в этом случае при переносе системы на другой диск нам
несомненно пришлось бы его изменить. Если бы мы указали положение корневой
системы привычным для линуксоидов образом: /dev/sda1, то не смогли бы
загрузиться с USB накопителя, т. к. это имя USB накопитель бы <span
class=GramE>получил только</span> будучи единственным накопителем в компьютере.
Маловероятно, что в компьютере окажется ещё один накопитель с меткой HABR, но
не стоит об этом забывать.<br>
<br>
Здесь же устанавливается значение глобальной переменной «ip» для нашего
обработчика «net» (не забудьте поменять адреса на используемые в вашей сети):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>linux<span
style='mso-spacerun:yes'>   </span>/boot/vmlinuz-linux root=LABEL=HABR rw<span
style='mso-spacerun:yes'>  </span>quiet
ip=192.168.1.100::192.168.1.1:255.255.255.0::eth0:none</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
В соседней строке есть упоминание файла initramfs, с которым я обещал
разобраться:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span class=GramE><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>initrd<span
style='mso-spacerun:yes'>  </span>/boot/initramfs-linux.img</span></span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Далее при загрузке происходит следующее: загрузчик GRUB получает файлы vmlinuz
и initramfs, сообщает им, где искать корневую файловую систему и передаёт им
управление дальнейшей загрузкой.<br>
<br>
Название initramfs образовано от initial ram file system. Это на самом деле
обычная корневая файловая система Linux, упакованная в архив. Она
разворачивается в оперативной памяти во время загрузки и предназначена для
того, чтобы найти и подготовить корневую файловую систему нашего linux, который
мы пытаемся загрузить в итоге. В initramfs есть всё необходимое для этих целей,
ведь это настоящий «маленький линукс», который может выполнять многие обычные
команды. Его возможности расширяются с помощью обработчиков (hooks), которые
помогают сформировать новую корневую файловую систему нашего linux.&nbsp;<br>
<br>
После того, как программы из initramfs выполнят свою работу, управление
дальнейшей загрузкой передается процессу init подготовленной корневой файловой
системы. В качестве процесса init Archlinux использует systemd.&nbsp;<br>
<br>
Менеджер устройств systemd-udevd является частью systemd. Он, как и его старший
брат, старается обнаруживать и настраивать все устройства в системе
параллельно. Он начинает свою работу одним из первых, но уже после того, как
наш обработчик net инициализирует сетевую карту ещё на на этапе работы
initramfs. Таким образом, systemd-udevd не может переименовать используемое
устройство, и имя eth0 сохраняется за сетевой картой в течение всего времени
работы.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Готовим initramfs<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Для создания файла initramfs используется программа mkinitcpio, которая входит
в пакет base, установленный нами в самом начале. Настройки находятся в файле
$root/etc/mkinitcpio.conf, а пресеты лежат в папке /etc/mkinitcpio.d. От нас
требуется сделать initramfs таким, чтобы он смог найти и подготовить корневую
файловую систему, с которой впоследствии начнёт работать systemd. Нам
совершенно необязательно учитывать все возможные варианты, достаточно только
самого необходимого, чтобы не увеличивать размеры файла initramfs. Более
подробная информация находится здесь&nbsp;<a
href="https://wiki.archlinux.org/index.php/Mkinitcpio"><span style='color:#992298'>wiki.archlinux.org/index.php/Mkinitcpio</span></a><br>
<br>
<span class=GramE>Обязательно</span> убираем обработчик autodetect. Он
проверяет <span class=GramE>устройства</span> установленные в данном конкретном
компьютере, и оставляет только необходимые для них модули в initramfs. Нам
этого не нужно, поскольку мы изначально рассматриваем возможность дальнейшего
переноса системы на другой компьютер, который аппаратно скорее всего будет
отличаться от используемой виртуальной машины.&nbsp;<br>
<br>
Достаточный для наших целей список обработчиков включая созданный нами net
выглядит следующим образом:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>HOOKS=</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>&quot;base udev net block filesystems&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
вставляем эту строку в файл mkinitcpio.conf, а старую комментируем:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nano </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/mkinitcpio.conf</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
На базе стандартного пресета linux создаем свой пресет habr:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>cp </span><span style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/mkinitcpio.d/linux.preset
</span><span style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'>/etc/mkinitcpio.d/habr.preset</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
И приводим его к такому виду:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>cat </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/mkinitcpio.d/habr.preset<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ALL_config=</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>&quot;/etc/mkinitcpio.conf&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ALL_kver=</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>&quot;/boot/vmlinuz-linux&quot;</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>PRESETS=(</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>'default'</span><span lang=EN-US style='font-size:
10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> )<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>default_image=</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#50A14F;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>&quot;/boot/initramfs-linux.img&quot;</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Нам не нужна ветка 'fallback', которая удаляет из обработчиков autodetect, ведь
мы его уже сами убрали, и нам не нужно дважды генерировать одинаковый файл
initramfs с разными названиями.<br>
<br>
Генерируем новый initramfs с помощью пресета habr:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>arch-chroot </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-fareast-language:RU'> mkinitcpio -p habr</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Пишем службу обновления DNS для
использования с systemd<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Наша сетевая карта получает все настройки для того, чтобы работала сеть и
Интернет. Но названия сайтов переводиться в IP адреса не будут, т. к. наша
система не знает, какие серверы DNS следует для этого использовать. Напишем
собственную службу для этих целей, которую при загрузке будет запускать
systemd. А чтобы узнать что-то новое и не заскучать от однообразия, передадим
информацию о названии сетевого устройства в качестве параметра, а список DNS серверов
сохраним во внешнем файле.<br>
<br>
Обновлением информации о DNS серверах занимается resolvconf. Нам идеально
подходит синтакскис:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>resolvconf
[-m metric] [-p] -a interface &lt;file</span><span lang=EN-US style='font-size:
12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
В импортируемом здесь файле IP адрес каждого сервера указывается в новой строке
после ключевого слова nameserver. Можно указать сколько угодно серверов, но
использоваться будут только первые 3 из них. В качестве примера воспользуемся
серверами Яндекс. В этом случае файл, передаваемый в resolvconf, должен
выглядеть вот так:&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nameserver 77.88.8.8<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>nameserver 77.88.8.1</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Нам нужно получать информацию о DNS серверах до того, как система будет
уверена, что сеть полностью работает, т. е. до достижения цели network.target.
Будем считать, что информацию о серверах нам достаточно обновлять один раз во
время загрузки. И стандартно скажем, что нашу службу требует цель
multi-user.target. Создаём файл запуска службы в каталоге со следующим
содержанием:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>cat </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/systemd/system/update_dns@.service<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>[Unit]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Description=Manual
resolvconf update (%i)<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Before=network.target<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>[Service]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>Type=oneshot<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>EnvironmentFile=/etc/default/dns@%i<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>ExecStart=/usr/bin/sh
-c </span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>'echo -e &quot;nameserver
${DNS0}\nnameserver ${DNS1}&quot; | resolvconf -a %i'</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>[Install]<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>WantedBy=multi-user.target</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span lang=EN-US style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-ansi-language:EN-US;mso-fareast-language:RU'><br>
</span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>В</span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>строке</span><span lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> ExecStart </span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>мы</span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'> </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>выполняем</span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>команду</span><span lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> echo, </span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>на</span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'> </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>лету</span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>генерирующую</span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> </span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-fareast-language:RU'>файл</span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-ansi-language:EN-US;mso-fareast-language:RU'> </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>со</span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>списком</span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> </span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-fareast-language:RU'>серверов</span><span lang=EN-US style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'>, </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>который</span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>через</span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-ansi-language:EN-US;
mso-fareast-language:RU'> </span><span style='font-size:12.0pt;font-family:
"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";color:#222222;
mso-fareast-language:RU'>конвейер</span><span style='font-size:12.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'> </span><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'>передаем</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'> resolvconf. </span><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'>Вообще, в строке ExecStart нельзя использовать несколько команд и тем более
нельзя использовать конвейеры, но мы снова всех обманули, передав эти команды в
качестве параметра -c для /usr/bin/sh.&nbsp;<br>
<br>
Обратите внимание, что в названии файла update_dns<span class=GramE>@.service</span>
используется символ @, после которого можно указать переменную, и она попадёт
внутрь файла, заменив собой &quot;%i&quot;. Таким образом строка EnvironmentFile=/etc/default/dns@%i
превратится в EnvironmentFile=/etc/default/dns@eth0 — именно это название
внешнего файла, мы будем использовать для хранения значения переменных DNS0 и
DNS1. Синтаксис как в обычных скриптах: «название переменной=значение
переменной». Создадим файл:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>nano </span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#986801;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'>$root</span><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>/etc/default/dns@eth0</span><span
lang=EN-US style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#222222;mso-ansi-language:EN-US;mso-fareast-language:
RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
И добавим следующие строки:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>DNS0=77.88.8.8<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>DNS1=77.88.8.1</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
<br>
Теперь добавляем службу в автозагрузку не забывая указать имя сетевой карты
после @:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span lang=EN-US style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>arch-chroot
</span><span lang=EN-US style='font-size:10.5pt;font-family:"Courier New";
mso-fareast-font-family:"Times New Roman";color:#986801;background:#FBFDFF;
mso-ansi-language:EN-US;mso-fareast-language:RU'>$root</span><span lang=EN-US
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:
RU'> systemctl </span><span lang=EN-US style='font-size:10.5pt;font-family:
"Courier New";mso-fareast-font-family:"Times New Roman";color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US;mso-fareast-language:RU'>enable</span><span
lang=EN-US style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:
"Times New Roman";color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US;
mso-fareast-language:RU'> update_dns@eth0.service</span><span lang=EN-US
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-ansi-language:EN-US;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
Только что мы написали универсальный файл, обеспечивающий запуск службы.
Универсальность заключается в <span class=GramE>том</span> что, если в нашей
системе окажется несколько сетевых адаптеров, то для каждого из них мы сможем
указать свои собственные DNS серверы. Нужно будет просто подготовить набор
файлов со списком серверов для каждого из устройств и запускать службу для
каждого адаптера в отдельности указывая его имя после @.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
24.0pt;mso-outline-level:2;background:white'><span style='font-size:18.0pt;
font-family:"Arial",sans-serif;mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'>Перед первым запуском<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
На этом первоначальная настройка закончена. Нам нужно загрузить установленный
ArchLinux с внутреннего накопителя, чтобы произведённые нами изменения вступили
в силу.<br>
<br>
Отключаем готовую корневую систему:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>umount </span><span
style='font-size:10.5pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#986801;background:#FBFDFF;mso-fareast-language:RU'>$root</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><span style='font-size:12.0pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#222222;mso-fareast-language:
RU'><br>
И выключаем виртуальную машину:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;tab-stops:45.8pt 91.6pt 137.4pt 183.2pt 229.0pt 274.8pt 320.6pt 366.4pt 412.2pt 458.0pt 503.8pt 549.6pt 595.4pt 641.2pt 687.0pt 732.8pt;
background:white;word-break:break-all'><span style='font-size:10.5pt;
font-family:"Courier New";mso-fareast-font-family:"Times New Roman";color:#383A42;
background:#FBFDFF;mso-fareast-language:RU'>poweroff</span><span
style='font-size:12.0pt;font-family:"Courier New";mso-fareast-font-family:"Times New Roman";
color:#222222;mso-fareast-language:RU'><o:p></o:p></span></p>

<p class=MsoNormal style='line-height:normal;background:white'><span
style='font-size:12.0pt;font-family:"Arial",sans-serif;mso-fareast-font-family:
"Times New Roman";color:#222222;mso-fareast-language:RU'><br>
<br>
Теперь можно отключить загрузочный образ из CD-ROM или достать флешку, после
этого включаем машину и убеждаемся, что всё работает.<br>
<br>
<a href="http://habrahabr.ru/post/253573/"><span style='color:#992298'>Продолжение</span></a>&nbsp;и&nbsp;<a
href="http://habrahabr.ru/post/254415/"><span style='color:#992298'>окончание</span></a>.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;line-height:
normal;background:white'><b><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
mso-fareast-font-family:"Times New Roman";color:#444444;mso-fareast-language:
RU'>Теги:<o:p></o:p></span></b></p>

<ul style='margin-top:0cm' type=disc>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5B%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0%20linux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>установка linux</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5B%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%B0%D0%BC%5D&amp;target_type=posts"><span
     style='color:#548EAA'>новичкам</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Bsystemd%5D&amp;target_type=posts"><span
     style='color:#548EAA'>systemd</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Bhooks%5D&amp;target_type=posts"><span
     style='color:#548EAA'>hooks</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Bvirtualbox%5D&amp;target_type=posts"><span
     style='color:#548EAA'>virtualbox</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Binitramfs%5D&amp;target_type=posts"><span
     style='color:#548EAA'>initramfs</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Barchlinux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>archlinux</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l1 level1 lfo3;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif;
     mso-fareast-font-family:"Times New Roman";mso-fareast-language:RU'><a
     href="https://habr.com/ru/search/?q=%5Barch%20linux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>arch linux</span></a><o:p></o:p></span></li>
</ul>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<h1 style='margin-top:0cm;margin-right:0cm;margin-bottom:8.25pt;margin-left:
0cm;background:white'><span class=posttitle-text><span style='font-family:"Arial",sans-serif;
color:#343434;font-weight:normal'>Разбираемся с загрузкой ArchLinux по сети</span></span></span><span
style='font-family:"Arial",sans-serif;color:#333333'><o:p></o:p></span></h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l2 level1 lfo4;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/linux/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Настройка Linux</span></a>,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l2 level1 lfo4;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/sys_admin/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Системное
администрирование</span></a>,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l2 level1 lfo4;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/network_technologies/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Сетевые
технологии</span></a><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l3 level1 lfo5;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:10.5pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#333333'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span class=posttype-label><span
style='font-size:9.0pt;font-family:"Arial",sans-serif;color:#6667A3;position:
relative;top:1.0pt;mso-text-raise:-1.0pt'><span title="Обучающий материал"
style='display:inline-block;border-radius: 2px'>Tutorial</span></span></span><span
style='font-size:10.5pt;font-family:"Arial",sans-serif;color:#333333'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'>В&nbsp;<a href="http://habrahabr.ru/post/253256/"><span
style='color:#992298'>предыдущей статье</span></a>&nbsp;мы подготовили базовую
систему. Закончим настройку в&nbsp;<a href="http://habrahabr.ru/post/254415/"><span
style='color:#992298'>следующей статье</span></a>.<br>
<br>
Здесь мы создадим новую систему Arch Linux, способную загружаться по сети и
автоматически запускать браузер Firefox, а между делом разберёмся с необходимой
функциональностью загрузочного сервера. Потом настроим сам сервер и попробуем с
него загрузиться. Всё произойдёт в точности, как на картинке, которую нашёл
гугл по запросу «PXE»:<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222;mso-fareast-language:
RU;mso-no-proof:yes'><!--[if gte vml 1]><v:shapetype id="_x0000_t75"
 coordsize="21600,21600" o:spt="75" o:preferrelative="t" path="m@4@5l@4@11@9@11@9@5xe"
 filled="f" stroked="f">
 <v:stroke joinstyle="miter"/>
 <v:formulas>
  <v:f eqn="if lineDrawn pixelLineWidth 0"/>
  <v:f eqn="sum @0 1 0"/>
  <v:f eqn="sum 0 0 @1"/>
  <v:f eqn="prod @2 1 2"/>
  <v:f eqn="prod @3 21600 pixelWidth"/>
  <v:f eqn="prod @3 21600 pixelHeight"/>
  <v:f eqn="sum @0 0 1"/>
  <v:f eqn="prod @6 1 2"/>
  <v:f eqn="prod @7 21600 pixelWidth"/>
  <v:f eqn="sum @8 21600 0"/>
  <v:f eqn="prod @7 21600 pixelHeight"/>
  <v:f eqn="sum @10 21600 0"/>
 </v:formulas>
 <v:path o:extrusionok="f" gradientshapeok="t" o:connecttype="rect"/>
 <o:lock v:ext="edit" aspectratio="t"/>
</v:shapetype><v:shape id="Рисунок_x0020_1" o:spid="_x0000_i1026" type="#_x0000_t75"
 alt="https://habrastorage.org/files/d01/7d4/5c8/d017d45c8fa84b22929222d40306129b.png"
 style='width:511.5pt;height:225pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="archlinux-habr-habr.files/image001.png" o:title="d017d45c8fa84b22929222d40306129b"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=682 height=300
src="archlinux-habr-habr.files/image001.png"
alt="https://habrastorage.org/files/d01/7d4/5c8/d017d45c8fa84b22929222d40306129b.png"
v:shapes="Рисунок_x0020_1"><![endif]></span><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Снова
устанавливаем Linux<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Archlinux выгодно отличается от готовых дистрибутивов тем, что установка новой
системы из рабочей машины осуществляется точно так же, как при использовании
установочного образа, и в обоих случаях вы получаете самую актуальную на данный
момент версию системы. Понадобятся лишь небольшие установочные скрипты:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S arch-install-scripts</span></code><span style='font-size:
12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Совершенно предсказуемое начало:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>export</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> root=/srv/nfs/diskless<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>mkdir -p </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Установим только базовые пакеты, поэтому:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacstrap -d -c -i </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> base</span></code><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>Примечание:</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Далее повторите все действия вплоть до установки загрузчика согласно&nbsp;<a
href="http://habrahabr.ru/post/253256/"><span style='color:#992298'>предыдущей
статье</span></a>. Вот чек-лист:<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l6 level1 lfo6;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>проведите русификацию (интернационализацию);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l6 level1 lfo6;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>укажите часовой пояс и настройте автозапуск службы NTP;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l6 level1 lfo6;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>добавьте пользователя username и заблокируйте его пароль от
изменения.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;background:
white'><span style='font-family:"Arial",sans-serif;color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Сравним
загрузку с диска и загрузку по сети</span></b><span style='font-size:15.0pt;
font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
В&nbsp;<a href="http://habrahabr.ru/post/253256/"><span style='color:#992298'>предыдущей
статье</span></a>&nbsp;мы рассматривали процесс загрузки Linux с точки зрения
внутреннего накопителя. Сейчас мы представим происходящее глазами сетевой
карты. Картинка из заголовка хорошо иллюстрирует события за исключением того,
что все серверы в нашем случае будут работать на одном компьютере.<br>
<br>
Сразу после включения компьютера, срабатывает код PXE (Preboot eXecution
Environment, произносится пикси — спасибо&nbsp;<a
href="https://ru.wikipedia.org/wiki/PXE"><span style='color:#992298'>вики</span></a>),
разместившийся непосредственно в ПЗУ сетевой карты. Его задача — найти
загрузчик и передать ему управление.</span><span style='font-size:12.0pt;
line-height:107%;font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>Примечание:</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Сетевой адаптер совершенно не представляет в какой сети сейчас находится,
поэтому назначает себе адрес 0.0.0.0 и отправляет сообщение DHCPDISCOVER. К
сообщению прикреплются&nbsp;<s>паспортные</s>данные, которые обязательно нам
пригодятся:<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l0 level1 lfo7;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>ARCH Option 93 —&nbsp;<a
href="http://tools.ietf.org/html/rfc4578"><span style='color:#992298'>архитектура</span></a>&nbsp;PXE
клиента (UEFI, BIOS);<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l0 level1 lfo7;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>Vendor-Class Option 60 — идентификатор, который у всех PXE
клиентов имеет вид «PXEClient:Arch:xxxxx:UNDI:yyyzzz», где цифры xxxxx –
архитектура клиента, yyyzzz – мажорная и минорная версии драйвера UNDI
(Universal Network Driver Interface).<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;background:
white'><span style='font-family:"Arial",sans-serif;color:#222222'><br>
<br>
Адаптер ожидает получить ответ от&nbsp;<a
href="https://ru.wikipedia.org/wiki/DHCP"><span style='color:#992298'>DHCP
сервера</span></a>&nbsp;по протоколу BOOTP (<a
href="https://ru.wikipedia.org/wiki/Bootstrap_Protocol"><span style='color:
#992298'>Bootstrap Protocol</span></a>), где помимо нужного IP адреса, маски
подсети и адреса шлюза, присутствует информация об адресе&nbsp;<a
href="https://ru.wikipedia.org/wiki/TFTP"><span style='color:#992298'>TFTP-сервера</span></a>&nbsp;и
названии файла загрузчика, который с него следует забрать. Сервер TFTP, в свою
очередь, просто отдаёт любому желающему любые файлы, которые у него попросят.<br>
<br>
После получения ответа и применения сетевых настроек, дальнейшее управление
загрузкой передаётся полученному файлу, размер которого не может превышать 32
кБ, поэтому используется двухстадийная загрузка. Всё необходимое для
отображения на экране загрузочного меню докачивается следом по тому же
протоколу TFTP. Подавляющее большинство руководств по сетевой загрузке
использует загрузчик pxelinux, но GRUB умеет то же самое, и даже больше: в нём
есть разные загрузчики для разных архитектур, включая UEFI.<br>
<br>
Далее загрузка приостанавливается на время отображения загрузочного меню, а
потом по тому же протоколу TFTP докачиваются выбранные файлы vmlinuz и
initramfs, которым передается дальнейшее управление загрузкой. На этом этапе
уже нет вообще никакой разницы в механизме загрузки по сети или с внутреннего
накопителя.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Настраиваем
загрузку по сети с помощью GRUB</span></b><span style='font-size:15.0pt;
font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Поскольку GRUB на нашем сервере уже есть, создадим с его помощью структуру
папок для сетевого клиента вот таким образом:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>grub-mknetdir --net-directory=</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/boot --subdir=grub</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
В папке $root/boot появится папка grub и несколько других. Эту файловую
структуру мы будем целиком «отдавать» с помощью TFTP-сервера. Сейчас мы используем
64-битный ArchLinux по той причине, что в 32-битной системе нет папки
/grub/x86_64-efi/, которая требуется для загрузки систем UEFI. Можно взять эту
папку с нашего 64-битного сервера и в неизменном виде перенести на 32-битный
сервер, тогда в нём также появится поддержка UEFI.<br>
<br>
Создайте файл конфигурации загрузчика со следующим содержимым:</span><span
style='font-size:12.0pt;line-height:107%;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>cat $root/boot/grub/grub.cfg</span><span style='font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Я взял файл grub.cfg с сервера и убрал из него всё то, что не участвует в
отображении загрузочного меню GRUB или как-то связано с дисками.<br>
<br>
Обратите внимание на знакомую нам строку с параметрами ядра:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>linux /vmlinuz-linux add_efi_memmap ip=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$net_default_ip</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>:</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$net_default_server</span></span><span class=hljs-string><span
lang=EN-US style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>:192.168.1.1:255.255.255.0::eth0:none nfsroot=</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${net_default_server}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>:/diskless</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Как и в&nbsp;<a href="http://habrahabr.ru/post/253256/"><span style='color:
#992298'>предыдущий раз</span></a>&nbsp;присваиваем значение переменной «ip».
Напоминаю, что она используется в обработчике «net», который мы приспособили
для настройки сетевой карты в загрузочном сервере. Здесь снова указывается статический
IP адрес и постоянное имя сетевой карты eth0. Значения $net_default_ip и
$net_default_server подставляются GRUB самостоятельно на основании данных,
полученных из самого первого DHCP запроса. $net_default_ip – это выделенный для
нашей машины IP адрес, а $net_default_server — IP адрес загрузочного сервера.<br>
<br>
Большинство руководств по сетевой загрузке (среди обнаруженных на просторах
рунета), предлагают устанавливать переменную так «ip=::::::eth0:dhcp», что
вынуждает обработчик net отправлять новый запрос DHCPDISCOVER для повторного
получения сетевых настроек.&nbsp;<br>
<br>
Нет объективной причины лишний раз «спамить» DHCP-сервер и ждать, пока он
откликнется, поэтому снова используем статику и не забываем указать
DNS-серверы. Такую задачу мы уже решали, поэтому просто копируем нужные файлы и
добавляем службу в автозагрузку:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cp {,</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>}/etc/systemd/system/update_dns@.service &amp;&amp; cp {,</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>}/etc/default/dns@eth0 &amp;&amp; arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> systemctl </span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>enable</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> update_dns@eth0</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Возвращаемся к строке с параметрами ядра. Ещё незнакомая нам команда
add_efi_memmap (EFI memory map)&nbsp;<a
href="https://www.kernel.org/doc/Documentation/x86/x86_64/uefi.txt"><span
style='color:#992298'>добавляет EFI memory map доступной RAM</span></a>. В
прошлый раз мы её намеренно пропустили, из-за сравнительно сложной
предварительной разметки носителя для поддержки UEFI. Сейчас нам ничего
размечать не нужно, потому что файловая система на загрузочном сервере уже
существует и будет использоваться в неизменном виде.<br>
<br>
Переменная ядра — nfsroot показывает, где именно в сети нужно искать корневую
файловую систему. Она выполняет ту же самую функцию, что и переменная root в
загрузочном сервере. В данном случае указан адрес&nbsp;<a
href="https://ru.wikipedia.org/wiki/Network_File_System"><span
style='color:#992298'>NFS-сервера</span></a>, который в нашем случае совпадает
с TFTP-сервером, но это совершенно необязательно.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Подготавливаем
initramfs</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
За подключение корневой файловой системы по протоколу NFS отвечает обработчик
net. В прошлый раз мы убирали из него эту функциональность, но сейчас она нам
понадобится, правда, в немного доработанном виде. Дело в том, что обработчик
net из коробки поддерживает подключение только по протоколу NFS версии 3. К
счастью, поддержка 4-й версии добавляется очень просто.&nbsp;<br>
<br>
Сначала установим пакет, в который входит нужный нам обработчик net, а также
пакет утилит для работы с NFS (модуль nfsv4 и программа mount.nfs4):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman --root </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> --dbpath </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/var/lib/pacman -S mkinitcpio-nfs-utils nfs-utils</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Исправим обработчик net из папки hooks (вместо команды для монтирования
nfsmount, теперь будем использовать mount.nfs4):<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>sed s/nfsmount/mount.nfs4/ </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>/usr/lib/initcpio/hooks/net&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt; </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/initcpio/hooks/net_nfs4&quot;</span></span><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
С помощью установщика обработчика из папки install добавим модуль nfsv4 и
программу mount.nfsv4 в iniramfs. Сначала копируем и переименовываем заготовку:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>cp </span></code><span class=hljs-variable><span style='font-size:
10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/usr/lib/initcpio/install/net </span></code><span
class=hljs-variable><span style='font-size:10.5pt;color:#986801;background:
#FBFDFF'>$root</span></span><code><span style='font-size:10.5pt;color:#383A42;
background:#FBFDFF'>/etc/initcpio/install/net_nfs4</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Теперь исправляем только одну функцию build(), а всё остальное не трогаем:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/initcpio/install/net_nfs4<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><span class=hljs-title><span lang=EN-US style='font-size:
10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:EN-US'>build</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>() {<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>add_checked_modules </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'/drivers/net/'</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>add_module nfsv4?<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>add_binary </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/usr/lib/initcpio/ipconfig&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;/bin/ipconfig&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>add_binary </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/usr/bin/mount.nfs4&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;/bin/mount.nfs4&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>add_runscript<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>}</span></code><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Добавляем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>обработчик</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>в</span><span lang=EN-US
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'>
initramfs </span><span style='font-family:"Arial",sans-serif;color:#222222'>путём</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>исправления</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>строки</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>в</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>файле</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> mkinitcpio.conf:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/mkinitcpio.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>HOOKS=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;base udev net_nfs4&quot;</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Если ничего не трогать, то обычно для сжатия файла initramfs используется
быстрый архиватор gzip. Мы не настолько торопимся, насколько хотим компрессию
посильнее, поэтому воспользуемся xz. Снимаем комментарий с этой строки в файле
mkinitcpio.conf:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>COMPRESSION=</span></code><span class=hljs-string><span
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;xz&quot;</span></span><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Архивация xz происходит значительно дольше, но файл initramfs при этом
уменьшается минимум в пару раз, из-за чего гораздо быстрее передается TFTP
сервером по сети. Копируем пресет с нашего сервера, чтобы в ходе работы
генерировался только один файл initramfs, после чего запускаем mkinitcpio:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>cp /etc/mkinitcpio.d/habr.preset </span></code><span
class=hljs-variable><span style='font-size:10.5pt;color:#986801;background:
#FBFDFF'>$root</span></span><code><span style='font-size:10.5pt;color:#383A42;
background:#FBFDFF'>/etc/mkinitcpio.d/habr.preset &amp;&amp; arch-chroot </span></code><span
class=hljs-variable><span style='font-size:10.5pt;color:#986801;background:
#FBFDFF'>$root</span></span><code><span style='font-size:10.5pt;color:#383A42;
background:#FBFDFF'> mkinitcpio -p habr</span></code><span style='font-size:
12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Напоследок отредактируем fstab. Здесь можно подобрать опции монтирования
корневой файловой системы, чтобы оптимизировать её работу, но мы ничего трогать
не будем:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;192.168.1.100:/diskless / nfs defaults 0 0&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt;&gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/etc/fstab</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Базовая установка клиентской системы на этом закончена. Но мы хотим добавить
графическое окружение и автоматический запуск Firefox.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Загружаемся
в Firefox</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Для уменьшения объема памяти, занимаемого нашей системой, мы откажемся от
использования&nbsp;<a
href="https://wiki.archlinux.org/index.php/Display_manager"><span
style='color:#992298'>экранного менеджера</span></a>&nbsp;и остановимся на
простейшем&nbsp;<a href="https://wiki.archlinux.org/index.php/Window_manager"><span
style='color:#992298'>оконном менеджере</span></a>, например,&nbsp;<a
href="http://openbox.org/wiki/Main_Page"><span style='color:#992298'>openbox</span></a>&nbsp;с
автоматической авторизацией пользователя username. Использование «облегченных»
компонентов позволит системе замечательно запускаться и работать даже на самом
древнем железе.&nbsp;<br>
<br>
Установим модули для поддержки VirtualBox, сервер X, симпатичный TTF-шрифт,
openbox и firefox (все остальные модули будут установлены как зависимости):<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman --root </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> --dbpath </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/var/lib/pacman -S virtualbox-guest-modules virtualbox-guest-utils xorg-xinit ttf-dejavu openbox firefox</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Включаем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>автозагрузку</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>службы</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> virtualbox:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> systemctl </span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>enable</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> vboxservice</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Добавим автоматический вход пользователя username без ввода пароля, для этого
изменим строку запуска agetty:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mkdir </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/systemd/system/getty@tty1.service.d &amp;&amp; \<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> -e </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;[Service]\nExecStart=\nExecStart=-/usr/bin/agetty --autologin username --noclear %I<span style='mso-spacerun:yes'>  </span>38400 linux Type=simple %I&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/etc/systemd/system/getty@tty1.service.d/autologin.conf</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Сразу же после авторизации пользователя выполняется файл ~/.bash_profile, из
его домашней папки, куда мы добавляем автоматический запуск графического
сервера:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'[[ -z $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]] &amp;&amp; exec startx &amp;&gt; /dev/null'</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt;&gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/home/username/.bash_profile</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
За запуском X-сервера должен стартовать openbox:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cp </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/X11/xinit/xinitrc </span></code><span class=hljs-variable><span
lang=EN-US style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/home/username/.xinitrc &amp;&amp; </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>echo</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>'exec openbox-session'</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt;&gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/home/username/.xinitrc</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Закомментируйте следующие строки в самом конце файла (от строки twm до
добавленной нами строки с запуском openbox, но не включая её):<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cat </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/home/username/.xinitrc<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><span class=hljs-comment><i><span lang=EN-US
style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'># twm &amp;</span></i></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
lang=EN-US style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'># xclock -geometry 50x50-1+1 &amp;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># xterm -geometry 80x50+494+51 &amp;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># xterm -geometry 80x20+494-0 &amp;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># exec xterm -geometry 80x66+0+0 -name login</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;
color:#C18401;background:#FBFDFF;mso-ansi-language:EN-US'>exec</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> openbox-session</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Копируем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>конфигурационные</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>файлы</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> openbox<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mkdir -p </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/home/username/.config/openbox &amp;&amp; cp -R </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/xdg/openbox/* </span></code><span class=hljs-variable><span
lang=EN-US style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/home/username/.config/openbox</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Добавляем firefox в автозагрузку в окружении openbox:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> -e </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'exec firefox habrahabr.ru/post/253573/'</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt;&gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/home/username/.config/openbox/autostart</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Поскольку мы только что от имени суперпользователя хозяйничали в домашней папке
пользователя username, нам нужно вернуть ему права на все файлы, расположенные
в его папке:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>chown -R username </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/home/username</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Подготовка системы к загрузке по сети закончена, и настала пора переходить к настройке
загрузочного сервера. Теперь мы знаем, что для загрузки нам понадобятся:</span><span
style='font-size:12.0pt;line-height:107%;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l9 level1 lfo8;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>DHCP-сервер с поддержкой протокола BOOTP для настройки сетевой
карты;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l9 level1 lfo8;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>TFTP-сервер для передачи загрузчика и файлов vmlinuz и
initramfs, которые у нас находятся в папке $root/boot/grub;<o:p></o:p></span></p>

<p class=MsoNormal style='mso-margin-top-alt:auto;mso-margin-bottom-alt:auto;
margin-left:22.5pt;text-indent:-18.0pt;line-height:normal;mso-list:l9 level1 lfo8;
tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:11.0pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#222222'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-family:"Arial",sans-serif;
color:#222222'>NFS-сервер для размещения корневой файловой системы, которая
лежит у нас в папке $root.<o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;background:
white'><span style='font-family:"Arial",sans-serif;color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Настраиваем
загрузочный сервер<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Дальнейшие шаги с небольшими изменениями повторяют&nbsp;<a
href="https://wiki.archlinux.org/index.php/Diskless_system"><span
style='color:#992298'>эту статью из вики</span></a>, поэтому минимум
комментариев с моей стороны.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Устанавливаем
DHCP сервер</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Скачиваем пакет:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S dhcp</span></code><span style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
и приводим содержимое конфигурационного файла /etc/dhcpd.conf к следующему
виду:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>mv /etc/dhcpd.conf /etc/dhcpd.conf.old </span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-size:12.0pt;
line-height:107%;font-family:"Arial",sans-serif;color:#222222'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>nano /etc/dhcpd.conf</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Как видите, DHCP-сервер будет отвечать только на те запросы DHCPDISCOVER,
которые придут от PXE клиентов, а остальные просто проигнорируются.<br>
<br>
Запускаем DHCP сервер:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>systemctl start dhcpd4</span></code><span style='font-size:12.0pt;
color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Устанавливаем
TFTP сервер</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Скачиваем и устанавливаем необходимый пакет:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S tftp-hpa</span></code><span style='font-size:12.0pt;
color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Нам нужно, чтобы TFTP сервер предоставлял доступ к файлам загрузчика, которые
мы разместили в папке $root/boot. Для этого модифицируем запуск службы уже
проверенным способом:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>mkdir -p /etc/systemd/system/tftpd.service.d &amp;&amp; </span></code><span
class=hljs-builtin><span style='font-size:10.5pt;color:#C18401;background:#FBFDFF'>echo</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> -e </span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>'[Service]\nExecStart=\nExecStart=/usr/bin/in.tftpd -s /srv/nfs/diskless/boot'</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> &gt; /etc/systemd/system/tftpd.service.d/directory.conf</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Первая строка «ExecStart=» отменяет выполнение команды, указанной в
оригинальном файле $root/usr/lib/systemd/system/tftpd.service, а вместо нее
выполняется &quot;/usr/bin/in.tftpd -s /srv/nfs/diskless/boot&quot;. Только в
том случае, когда служба запускается однократно (Type=oneshot), мы можем
использовать несколько строк ExecStart= чтобы выполнять команды одну за другой.
Это не тот случай, поэтому отменяем одну команду и выполняем другую.<br>
<br>
Запускаем TFTP сервер:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>systemctl start tftpd.socket tftpd.service</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Устанавливаем
NFS сервер</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Скачиваем пакет:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S nfs-utils</span></code><span style='font-size:12.0pt;
color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Добавляем папку, в которую мы установили систему, в список экспортируемых:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> -e </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/srv/nfs 192.168.1.0/24(rw,fsid=root,no_subtree_check,no_root_squash)\n</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'> 192.168.1.0/24(rw,no_subtree_check,no_root_squash)&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt;&gt; /etc/exports</span></code><span lang=EN-US style='font-size:
12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Не забываем использовать синтаксис NFS v.4 указывая путь относительно папки с
fsid=root (корневой по отношению ко всем остальным экспортируемым папкам, без
указания которой ничего работать не будет).<br>
<br>
Запускаем службы, обеспечивающие работу NFS-сервера:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>systemctl start rpcbind nfs-server</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
На этом загрузочный сервер готов к работе.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Пробуем
загрузиться по сети<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Проследим за процессом загрузки с сервера с помощью программы tcpdump<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman -S tcpdump<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>tcpdump -v </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'( \<o:p></o:p></span></span></pre><pre
style='background:white;word-break:break-all'><span class=hljs-string><span
lang=EN-US style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>src host 0.0.0.0 and udp[247:4] = 0x63350101) or ( \<o:p></o:p></span></span></pre><pre
style='background:white;word-break:break-all'><span class=hljs-string><span
lang=EN-US style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>dst host HabraBoot and dst port tftp) or ( \<o:p></o:p></span></span></pre><pre
style='background:white;word-break:break-all'><span class=hljs-string><span
lang=EN-US style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>dst host HabraBoot and tcp[tcpflags] == tcp-syn)'</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Первая строка
«ловит» запрос DHCPDISCOVER от PXE клиента. В выводе, отфильтрованном второй
строкой, будут перечислены имена всех файлов, запрашиваемых по TFTP. Третья
строка показывает два tcp-syn запроса, отправляемых в самом начале подключения
по протоколу NFS (первое соединение осуществляется обработчиком net, а второе
переподключение происходит во время обработки файла fstab).<br>
<br>
Создаём новую виртуальную машину, для краткости будем называть её «клиент». В
настройках сети снова указываем тип подключения «Сетевой мост» и включаем
машину. Сразу же нажимаем клавишу F12 на клавиатуре для выбора загрузочного
устройства, а потом клавишу l, чтобы загрузиться по сети.<br>
<br>
Дождитесь окончания загрузки. Если всё в порядке, то на сервере добавляем
используемые службы в автозагрузку:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>systemctl </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>enable</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> tftpd.socket tftpd.service dhcpd4 rpcbind nfs-server</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Все серверы DHCP, TFTP и NFS мы запустили на одном загрузочном сервере. Делать
так необязательно. Например, роутеры Mikrotik поддерживают Bootp и позволяют
использовать себя в качестве TFTP — просто закачайте туда все нужные файлы и
проверьте сетевые настройки.<br>
<br>
Сейчас графическое окружение будет работать только в VirtualBox, потому что мы
не устанавливали драйверы для «железных» видеокарт. Мы решим проблему
автоматического подбора нужных драйверов в&nbsp;<a
href="http://habrahabr.ru/post/254415/"><span style='color:#992298'>следующей
статье</span></a>. Заодно ускорим загрузку системы и сделаем из неё «живой
образ».</span><span style='font-size:12.0pt;line-height:107%;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><b><span style='font-size:10.5pt;
line-height:107%;font-family:"Arial",sans-serif;color:#444444'>Теги:<o:p></o:p></span></b></p>

<ul style='margin-top:0cm;display:flex;flex-wrap: wrap;align-items: flex-start'
 type=disc>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5B%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%B0%D0%BC%5D&amp;target_type=posts"><span
     style='color:#548EAA'>новичкам</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5B%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%BA%D0%B0%20%D0%BE%D1%81%5D&amp;target_type=posts"><span
     style='color:#548EAA'>загрузка ос</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Barchlinux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>archlinux</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Barch%20linux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>arch linux</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bgrub%5D&amp;target_type=posts"><span
     style='color:#548EAA'>grub</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Binitramfs%5D&amp;target_type=posts"><span
     style='color:#548EAA'>initramfs</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Btftpboot%5D&amp;target_type=posts"><span
     style='color:#548EAA'>tftpboot</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bnfsv4%5D&amp;target_type=posts"><span
     style='color:#548EAA'>nfsv4</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l10 level1 lfo9;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bdhcpd%5D&amp;target_type=posts"><span
     style='color:#548EAA'>dhcpd</span></a><o:p></o:p></span></li>
</ul>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<h1 style='margin-top:0cm;margin-right:0cm;margin-bottom:8.25pt;margin-left:
0cm;background:white'><span class=posttitle-text><span style='font-family:"Arial",sans-serif;
color:#343434;font-weight:normal'>Стань повелителем загрузки Linux</span></span></span><span
style='font-family:"Arial",sans-serif;color:#333333'><o:p></o:p></span></h1>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l8 level1 lfo10;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/linux/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Настройка Linux</span></a>,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l8 level1 lfo10;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/sys_admin/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Системное
администрирование</span></a>,<o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l8 level1 lfo10;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;font-family:Symbol;mso-fareast-font-family:Symbol;
mso-bidi-font-family:Symbol;color:#5E6973'><span style='mso-list:Ignore'>·<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span style='font-size:10.0pt;font-family:"Arial",sans-serif;
color:#5E6973'><a href="https://habr.com/ru/hub/network_technologies/"
title="Вы не подписаны на этот хаб"><span style='color:#5E6973'>Сетевые
технологии</span></a><o:p></o:p></span></p>

<p class=MsoNormal style='margin-top:0cm;margin-right:6.0pt;margin-bottom:0cm;
margin-left:18.0pt;margin-bottom:.0001pt;text-indent:-18.0pt;line-height:normal;
mso-list:l7 level1 lfo11;tab-stops:list 36.0pt;background:white'><![if !supportLists]><span
style='font-size:10.0pt;mso-bidi-font-size:10.5pt;font-family:Symbol;
mso-fareast-font-family:Symbol;mso-bidi-font-family:Symbol;color:#333333'><span
style='mso-list:Ignore'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><![endif]><span class=posttype-label><span
style='font-size:9.0pt;font-family:"Arial",sans-serif;color:#6667A3;position:
relative;top:1.0pt;mso-text-raise:-1.0pt'><span title="Обучающий материал"
style='display:inline-block;border-radius: 2px'>Tutorial</span></span></span><span
style='font-size:10.5pt;font-family:"Arial",sans-serif;color:#333333'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'>Сначала мы познакомимся с udev и научимся с его помощью
исследовать установленные в компьютере устройства прямо во время загрузки: в
качестве примера будем автоматически выбирать настройки видеокарт для Xorg.
Затем решим задачу работы с одним образом на десятках компьютеров одновременно
путём внедрения собственного обработчика в initramfs, а заодно оптимизируем
систему для сетевой загрузки. Чтобы дополнительно уменьшить время загрузки и
снизить нагрузку на сеть попробуем NFS заменить на NBD, и помочь TFTP с помощью
HTTP. В конце вернёмся в начало — к загрузочному серверу, который также
переведём в режим «только для чтения».<br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222;mso-fareast-language:
RU;mso-no-proof:yes'><!--[if gte vml 1]><v:shape id="Рисунок_x0020_2" o:spid="_x0000_i1025"
 type="#_x0000_t75" alt="https://habrastorage.org/files/7a7/b69/abc/7a7b69abca3b47c69975721d79c531f9.jpg"
 style='width:20in;height:963.75pt;visibility:visible;mso-wrap-style:square'>
 <v:imagedata src="archlinux-habr-habr.files/image002.jpg" o:title="7a7b69abca3b47c69975721d79c531f9"/>
</v:shape><![endif]--><![if !vml]><img border=0 width=1920 height=1285
src="archlinux-habr-habr.files/image002.jpg"
alt="https://habrastorage.org/files/7a7/b69/abc/7a7b69abca3b47c69975721d79c531f9.jpg"
v:shapes="Рисунок_x0020_2"><![endif]></span><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Данная статья — скорее исследование, а не готовое руководство (все решения
работают, просто они не всегда оптимальны). В конце у вас появится достаточно
знаний, чтобы сделать всё так, как захотите именно вы.<br>
<br>
Начало смотрите здесь:<br>
<a href="http://habrahabr.ru/post/253256/"><span style='color:#992298'>Первоначальная
настройка сервера</span></a><br>
<a href="http://habrahabr.ru/post/253573"><span style='color:#992298'>Подготовка
образа для загрузки по сети</span></a><br>
<br>
Мы остановились на том, что загрузили по сети машину VirtualBox и запустили
Firefox. Если сейчас попытаться сделать то же самое с настоящим компьютером, то
на экране появится циклическая авторизация пользователя username и безуспешные
попытки запустить графическое окружение —&nbsp;<a
href="https://wiki.archlinux.org/index.php/Xorg"><span style='color:#992298'>Xorg</span></a>не
находит нужный драйвер.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Запускаем
видеокарты<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Для работы графического режима в VirtualBox у нас установлено всё необходимое.
Изначально планировалось, что наша бездисковая система будет функционировать на
любом «железе», но&nbsp;<s>из-за лени</s>&nbsp;мы не станем пытаться объять
необъятное, поэтому ограничимся поддержкой графических решений следующих
доминирующих производителей: nVidia, Intel и AMD.&nbsp;<br>
<br>
Переключимся на машине-клиенте во второй терминал нажатием Ctrl+Alt+F2 и
установим открытые драйверы:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman -S xf86-video-ati xf86-video-nouveau xf86-video-intel</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Вероятнее всего, что на этот раз Xorg не сможет самостоятельно выбрать
подходящие настройки для каждого случая, и судя по экрану загруженного клиента
будет казаться, что вообще ничего не изменилось.<br>
<br>
Простейший способ узнать какие видеоустройства имеются в системе, это ввести в
консоли команду:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>lspci | grep -i vga<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>00:02.0 VGA compatible controller: InnoTek Systemberatung GmbH VirtualBox Graphics Adapter</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Но мы не будем искать лёгких путей, а в награду получим новую порцию знаний.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Ближе
знакомимся с udev</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Раньше я уже упоминал, что&nbsp;<b>менеджер устройств</b>&nbsp;в Archlinux
называется&nbsp;<a href="https://wiki.archlinux.org/index.php/Udev"><span
style='color:#992298'>udev</span></a>. Он входит в пакет systemd под именем
systemd-udevd.&nbsp;<br>
<br>
По мере обнаружения новых устройств в загружаемой системе, ядро создаёт их
иерархию в каталоге /devices. Сначала появляется сама система PCI, затем в ней
обнаруживаются шины, на которых «сидят» конечные устройства, а их драйверы
рассортировывают устройства по классам. Устройства внутри классов
обнаруживаются параллельно, точно как systemd параллельно запускает службы для
достижения следующей цели.&nbsp;<br>
<br>
Асинхронный поиск устройств приводит к тому, что если в компьютере одновременно
присутствует несколько устройств, относящихся к одному классу, то они могут
обнаруживаться в разном порядке от включения к включению, например, сначала
одна видеокарта, а потом — другая, и их имена при этом будут меняться между
собой. К счастью, появление нового элемента в иерархии устройств является
событием udev, которое можно отследить и принять необходимые меры.&nbsp;<br>
<br>
Для менеджера udev придуманы правила, призванные упорядочить хаос, и упростить
жизнь установленных программ. Правила хранятся в папках /usr/lib/udev/rules.d/
и /etc/udev/rules.d/ (последняя, как и в случае обработчиков (hooks), имеет
более высокий приоритет и файлы оттуда проверяются первыми). Появление нового
элемента в иерархии устройств сопровождается проверкой всех установленных
правил udev, и автоматическим выполнением указанных там действий, в случае
совпадения. Обычно эти действия заключаются в переименовании устройств и установки
на них ссылок в каталогах внутри /dev и /sys для удобства использования в
программах.<br>
<br>
Драйверы видеокарт относят их к подсистеме (классу) drm, поэтому сведения о
подобных устройствах дублируются в каталоге /sys/class/drm. Первая видеокарта,
обнаруженная в системе, по-умолчанию получает имя «card0», если в ней имеется
несколько видеовыходов, то они получают имена вида «card0-CON-n», где «CON» —
тип разъема (VGA, HDMI, DVI и др.), а «n» — порядковый номер разъема (причём
одни производители нумеруют разъёмы начиная с «0», а другие — с «1»). Следующая
видеокарта становится “card1” и т. д.&nbsp;<br>
<br>
Если ничего не предпринять, то в виду параллельности обнаружения при следующем
включении card1 может стать card0 и наоборот. Udev станет добавлять такие
устройства в /dev то с одним, то с другим именем. Случаи, когда такое поведение
udev нежелательно, подробно описаны в Интернете, и в них в основном обсуждаются
различные USB устройства. Нам же требуется при обнаружении видеокарт запускать
определённую программу, которую напишем чуть позже, а пока выясним, что
известно udev.&nbsp;<br>
<br>
Чтобы узнать то же самое, что знает про видеокарту udev, введём команду на
клиенте:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>udevadm info -a -p /sys/class/drm/card0</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>вывод команды</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Обратите внимание на древовидную структуру с использованием парадигмы
родительских и дочерних устройств. В строках, начинающихся с «looking at ...»
указан путь к данному устройству относительно каталога /sys, т. е. обратившись
к видеокарте по пути /sys/class/drm/card0, мы обнаружили, что на самом деле это
ссылка на /sys/devices/pci0000:00/0000:00:02.0/drm/card0.<br>
<br>
У родительского устройства /devices/pci0000:00/0000:00:02.0 есть атрибут vendor
с идентификатором производителя. Udev располагает доступом к обширной базе
данных и может перевести этот код в удобоваримый вид:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>udevadm info -q property -p /sys/devices/pci0000:00/0000:00:02.0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>DEVPATH=/devices/pci0000:00/0000:00:02.0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ID_MODEL_FROM_DATABASE=VirtualBox Graphics Adapter<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ID_PCI_CLASS_FROM_DATABASE=Display controller<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ID_PCI_INTERFACE_FROM_DATABASE=VGA controller<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ID_PCI_SUBCLASS_FROM_DATABASE=VGA compatible controller<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ID_VENDOR_FROM_DATABASE=InnoTek Systemberatung GmbH<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>MODALIAS=pci:v000080EEd0000BEEFsv00000000sd00000000bc03sc00i00<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>PCI_CLASS=30000<o:p></o:p></span></code></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>PCI_ID=80EE:BEEF<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>PCI_SLOT_NAME=0000:00:02.0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>PCI_SUBSYS_ID=0000:0000<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>SUBSYSTEM=pci<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>USEC_INITIALIZED=24450</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Сравните с выводом команды:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>lspci | grep -i vga<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>00:02.0 VGA compatible controller: InnoTek Systemberatung GmbH VirtualBox Graphics Adapter.</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Динамическая
настройка видеокарты с помощью udev</span></b><span style='font-size:15.0pt;
font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Подключитесь к загрузочному серверу. И создайте файл с правилами:<br
style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>export</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> root=/srv/nfs/diskless<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>nano </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/etc/udev/rules.d/10-graphics.rules<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>KERNEL==</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;card[0-9]*&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>, SUBSYSTEM==</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;drm&quot;</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>, RUN+=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/etc/default/xdevice %n&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>KERNEL==</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;card*&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>, SUBSYSTEM==</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;drm&quot;</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>, ATTR{enabled}==</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;enabled&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>, ATTR{status}==</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;connected&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>, RUN+=</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;/etc/default/xdevice %n %k&quot;</span></span><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Каждое правило записывается в новой строке. Первая часть служит для
идентификации события udev, к которому нужно применить действие, указанное в
конце строки. Для опознания события используются данные, которые можно получить
в выводе команды «udevadm info -a -p /sys...».&nbsp;<br>
<br>
Правило из первой строки срабатывает для всех устройств с именем (ядром) card0,
card1… подсистемы drm. Второе правило сработает только для активных устройств
из подсистемы drm, к которым в данный момент подключен монитор (оно не
сработает для card0, card1, а только для имен вида card0-HDMI-1, т. к. только у
таких устройств есть атрибуты enabled и status). При совпадении события с его
описанием выполняется одна и та же программа, в которую в первом случае
передаётся один параметр %n (порядковый номер ядра, который для card0 будет
«0»), а во втором — дополнительный параметр %k (само имя ядра «card0»).<br>
<br>
Программа /etc/default/xdevice будет изменять содержимое файла в папке
/etc/X11/xorg.conf.d/, в котором содержится информация о настройках
видеоадаптера для xorg. Для разных производителей мы подготовим разные шаблоны,
учитывающие особенности реализации. Достаточно указать минимально необходимую
информацию для однозначной идентификации устройства, а остальное xorg сделает
сам:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>Section </span></code><span class=hljs-string><span style='font-size:
10.5pt;color:#50A14F;background:#FBFDFF'>&quot;Device&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span>Identifier </span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;уникальный идентификатор устройства&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span>Driver<span style='mso-spacerun:yes'>     </span></span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;используемый драйвер&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span>Option<span style='mso-spacerun:yes'>     </span></span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;AccelMethod&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> </span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;метод ускорения&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span>BusID<span style='mso-spacerun:yes'>      </span></span></code><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>&quot;PCI:идентификатор шины PCI, куда физически установлен адаптер&quot;</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>EndSection</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Необходимые данные мы укажем в самом шаблоне или получим исследуя вывод команды
«udevadm info».&nbsp;<br>
<br>
Программа будет срабатывать для каждого выхода каждой видеокарты, к которому
подключен монитор. Для упрощения задачи заставим работать последний
обнаруженный вариант, чтобы на мультимониторных системах работал хотя бы один
монитор. Это не самый оптимальный способ настройки, и было бы лучше проверить
графическую подсистему один раз перед достижением graphical.target, но наш
вариантрабочий и подходит для изучения правил udev в действии.&nbsp;<br>
Создаём файл программы со следующим содержанием:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>nano </span></code><span class=hljs-variable><span style='font-size:
10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/etc/default/xdevice</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-size:12.0pt;
line-height:107%;font-family:"Arial",sans-serif;color:#222222'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>Скрытый текст</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Сделаем файл исполняемым:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>chmod +x </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/default/xdevice</span></code><span lang=EN-US style='font-size:
12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Отключаем автоматическую загрузку службы VirtualBox, т. к. теперь она будет
запускаться нашей программой только при необходимости:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>systemctl </span></code><span class=hljs-builtin><span
style='font-size:10.5pt;color:#C18401;background:#FBFDFF'>disable</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> vboxservice</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Добавляем шаблоны конфигурационных файлов xorg, с оптимизированными под
основных производителей настройками:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/X11/xorg-device-intel.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>Section </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;Device&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>Identifier </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;Intel %ID%&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>Driver<span style='mso-spacerun:yes'>     </span></span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;intel&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>Option<span style='mso-spacerun:yes'>     </span></span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;AccelMethod&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;uxa&quot;</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>BusID<span style='mso-spacerun:yes'>      </span></span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;PCI:%BUS%&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>EndSection</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#548EAA;mso-ansi-language:EN-US'>AMD, nVidia,
VirtualBox</span><span lang=EN-US style='font-family:"Arial",sans-serif;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
В завершение настройки xorg сделаем ”Windows like” переключение раскладки
клавиатуры комбинацией Alt+Shift:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/X11/xorg.conf.d/50-keyboard.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>Section </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;InputClass&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>Identifier </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;keyboard-layout&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>MatchIsKeyboard </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;on&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>Option </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;XkbLayout&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;us,ru&quot;</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>       </span>Option </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;XkbVariant&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;,winkeys&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>       </span>Option </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;XkbOptions&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;grp:alt_shift_toggle&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>EndSection</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Оптимизируем
систему<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<b>Логи работы</b>&nbsp;всех составляющих Archlinux сохраняются в&nbsp;<a
href="https://wiki.archlinux.org/index.php/Systemd#Journal"><span
style='color:#992298'>журнале</span></a>. Если всё оставить как есть, то журнал
может довольно сильно раздуть, поэтому ограничим его размер, скажем 30Мб
(добавьте или раскомментируйте строку):<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/systemd/journald.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>...<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>SystemMaxUse=30M<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>...</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Каждое действие протоколируется в папку /var/log/journal. В нашем случае
передача данных осуществляется по сети, которая на практике имеет невысокую
пропускную способность. Можно удалить папку с журналом, то он будет сохраняться
только в оперативной памяти, что идеально подходит для бездискового клиента:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>rm -r </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/var/</span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>log</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/journal</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
При различных ошибках в работе приложений в папке /var/lib/systemd/coredump
создаются автоматические&nbsp;<b>дампы ядра</b>. Мы их отключим по той же
причине:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>nano </span></code><span class=hljs-variable><span style='font-size:
10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/etc/systemd/coredump.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>...<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>Storage=none<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>...</span></code><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Отключаем</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'>&nbsp;<b>SWAP</b>:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> -e </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'vm.swappiness=0\nvm.vfs_cache_pressure=50'</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &gt; </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/etc/sysctl.d/99-sysctl.conf</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Удалим ненужные&nbsp;<b>локализации</b>. Это простое действие поможет
сэкономить более 65 Мб. Заодно посмотрим, как устанавливаются программы
из&nbsp;<a href="https://wiki.archlinux.org/index.php/Arch_User_Repository"><span
style='color:#992298'>AUR</span></a>&nbsp;(фактически они собираются из
исходников). Зайдите на загрузочный сервер с правами обычного пользователя и
выполните следующие действия:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>curl -o localepurge.tar.gz https://aur.archlinux.org/packages/lo/localepurge/localepurge.tar.gz<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>tar -xvvzf localepurge.tar.gz<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>cd</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> localepurge<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>makepkg -s</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Пакет готов. Устанавливаем его из файла, а не из репозитория, поэтому ключ S
заменяется на U (исправьте название файла, если версия собранной вами програмы
не совпадает с моей):<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>sudo pacman --root </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> --dbpath </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/var/lib/pacman -U localepurge-0.7.3.4-1-any.pkg.tar.xz</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Теперь настроим. Закомментируйте строку «NEEDCONFIGFIRST» в начале файла и
укажите используемые локализации в самом конце:<br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/locale.nopurge<o:p></o:p></span></code></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>...<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
lang=EN-US style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'># NEEDSCONFIGFIRST</span></i></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>...<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ru<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>ru_RU<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>ru_RU.UTF-8<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>en<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>en_US<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>en_US.UTF-8</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Конфигурируем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>и</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>запускаем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>программу</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'>:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> /usr/bin/localepurge-config<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>arch-chroot </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> localepurge</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Переходим</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US;
font-weight:normal'> </span><span style='font-family:"Arial",sans-serif;
color:#222222;font-weight:normal'>в</span><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US;font-weight:normal'>
read-only<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Если мы попробуем загрузить существующую систему на нескольких компьютерах
одновременно, то все копии будут изменять одни и те же папки на сервере. Если
один клиент удалит какой-то файл, то он неожиданно исчезнет и у другого. Самый
надежный способ защититься от изменений — перейти в режим только для чтения.<br>
<br>
Проблема в том, что для нормальной работы системы необходима возможность
записывать данные в некоторые папки. Решение на поверхности — подключить эти
папки через fstab как tmpfs — замечательно подойдёт для /var/log, например. Но
как поступить, например, с каталогом /etc, ведь наше правило udev меняет там
файлы, да и другие программы активно с ним работают? Можно где-то сохранить
информацию перед монтированием, а потом переписать обратно. Или сразу перенести
всё куда-то ещё, а потом вернуть. Ясно одно: придётся долго тестировать и
следить за работой системы, чтобы понять какие ещё папки сделать доступными для
записи, или же настроить все программы так, чтобы они оставляли продукты своей
жизнедеятельности строго в отведённом месте. Слишком мудрёно. Предлагаю всю
систему развернуть в RAM. Останется только предварительно переписать в неё всё
самое нужное для работы.&nbsp;<br>
<br>
Существует одна папка, в которую во время работы ничего не записывается, если
мы ничего не устанавливаем — это /usr. Если подмонтировать её на позднем этапе
работы initramfs с доступом только для чтения, то на работу Firefox это никак
не повлияет. Обязательно сравните размер каталога /usr с размером всего
остального, и получится, что копировать останется не так много, а если при этом
исключить всё лишнее… Вы тоже подумали о&nbsp;<a
href="https://wiki.archlinux.org/index.php/Rsync"><span style='color:#992298'>rsync</span></a>?<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Переделываем
файловую систему на лету</span></b><span style='font-size:15.0pt;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Устанавливаем rsync на клиента:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S rsync</span></code><span style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Заниматься копированием предстоит на этапе работы intramfs, следовательно,
понадобится новый обработчик, назовём его «live». Сначала сохраним все
необходимые параметры монтирования оригинального корневого каталога, путём
анализа файла /etc/fstab с помощью утилиты findmnt. Затем корневой каталог
отмонтируем от папки /new_root, где он всегда находится внутри initramfs. На
его месте создадим ramfs с возможностью записи и подготовим точку монтирования
/srv/new_root, куда вернём оригинальный корневой каталог. Останется только
переписать все самые нужные файлы и каталоги, за исключением папки /usr,
которую забиндим в режиме только для чтения. Копии файлов в ramfs будут
доступны для чтения и для записи.<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/initcpio/hooks/live</span></code><span lang=EN-US style='font-size:
12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#548EAA;mso-ansi-language:EN-US'>cat
$root/etc/initcpio/hooks/live</span><span lang=EN-US style='font-family:"Arial",sans-serif;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
К файлу /etc/fstab мы обращаемся дважды: первый раз получаем информацию по
параметрам монтирования корневого каталога, а второй раз проверяем, есть ли в
fstab какая-нибудь информация по /usr. Для позднего монтирования /usr в
Archlinux есть специальный обработчик usr, которому мы не будем мешать
выполнять свою работу. Если /usr монтируется каким-то особым образом, то наш
обработчик его пропускает.<br>
<br>
В тексте упомянут файл /etc/default/live_filter с правилами фильтрации,
предназначенными для rsync, нам нужно не забыть его подготовить. Сделаем это
автоматически из установщика обработчика:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>nano </span></code><span class=hljs-variable><span style='font-size:
10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/etc/initcpio/install/live<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-meta><span
lang=EN-US style='font-size:10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:
EN-US'>#!/usr/bin/bash<o:p></o:p></span></span></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-title><span
lang=EN-US style='font-size:10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:
EN-US'>build</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>() {<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>make_filter &gt; /etc/default/live_filter<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>add_binary </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/usr/bin/rsync&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;/bin/rsync&quot;</span></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>add_binary findmnt<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>add_runscript<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>}<o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-title><span
lang=EN-US style='font-size:10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:
EN-US'>make_filter</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>() {<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>cat &lt;&lt;EOF<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /etc/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>+ /home/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /home/*/.config<o:p></o:p></span></code></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>- /home/*/*/<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /var/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>- /var/cache/*/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>- /var/lib/pacman/*/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>- /var/lib/systemd/*/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /var/</span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>log</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/*/<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>- /var/</span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>log</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>- /var/tmp/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>- /*/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>EOF<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>}</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='margin-bottom:12.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222'><br>
Rsync «не видит» дальше одной директории. Файлы и папки в директории
проверяются каждым правилом по порядку до первого совпадения (&quot;+&quot; —
объект копируется, &quot;-&quot; — объект не копируется). Если совпадений нет,
то файл копируется, а директория создаётся пустой. Далее rsync заходит в «выжившую»
директорию и снова применяет правила к её содержимому. Так повторяется до тех
пор пока совсем ничего не останется.<br>
<br>
В нашем случае корневой каталог не попадает ни под одно правило, поэтому его
структура полностью переносится (копируются все файлы и создаются пустые
каталоги). Каталоги /boot, /dev, /lost+found, /mnt, /opt, /proc, /root, /run,
/srv, /sys, /tmp попадают под действие последнего правила &quot;- /*/*&quot;,
т.е. никакое их содержимое никуда не копируется, но сами они создаются. Каталог
/etc сразу же попадает под правило &quot;+ /etc/*&quot;, и всё его содержимое
копируется, но сначала только в пределах одного каталога (в дальнейшем вся его
структура будет перенесена по порядку, потому что для уровней вложенности
/etc/*/ и далее никаких правил нет). Похожее начало ждёт каталог /home — папки
всех пользователей попадают под правило &quot;+ /home/*&quot; и будут
воссозданы в копии (пока пустыми). Следующее правило &quot;+
/home/*/.config&quot; копирует каталоги .config, вложенные в домашние папки
каждого из пользователей, а &quot;- /home/*/*/&quot; исключает все остальные
каталоги (правило идёт после «спасательного», поэтому для /home/*/.config не
срабатывает). Про сами файлы из домашнего каталога ничего не говорится, поэтому
они полностью переносятся. Файлы из исключённых вложенных каталогов не копируются,
потому что эти каталоги не были созданы. Правило &quot;- /var/cache/*/*&quot;
сохраняет всю структуру каталогов в /var/cache, но их содержимое не
переносится. Остальные правила действуют аналогичным образом.</span><span
style='font-size:12.0pt;line-height:107%;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;background:
white'><span style='font-family:"Arial",sans-serif;color:#548EAA'>Замечания</span><span
style='font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Добавляем обработчик в initramfs:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cat </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/mkinitcpio.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>...<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>HOOKS=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;base udev net_nfs4 live&quot;</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Генерируем</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> initramfs:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> mkinitcpio -p habr</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>nfs4+live</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Разгоняем
сеть</span></b><span style='font-size:15.0pt;font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Физически, естественно, разгон сети сейчас невозможен без замены оборудования,
зато программные оптимизации не запрещаются. Нам нужно передавать содержимое
связанной папки /usr по сети. Не отправлять эти данные мы не можем, зато
способны уменьшить объём занимаемого ими места — заархивировать. На сервере
сжимаем, а на клиенте — распаковываем, и через ту же самую сеть теоретически
передаётся больше данных за единицу времени.<br>
<br>
Файловая система squashfs совмещает в себе возможности архиватора и
монтирования архивов через fstab, как обычную файловую систему. Основной
недостаток данной файловой системы — невозможность работать в режиме записи
(только для чтения) — для нас недостатком не является:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman -S squashfs-tools &amp;&amp; mksquashfs </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/usr </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/srv/source_usr.sfs -b 4096 -comp xz</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Монтировать будем так:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>nano </span></code><span class=hljs-variable><span style='font-size:
10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/etc/fstab<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
lang=EN-US style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'># &lt;file system&gt;<span style='mso-spacerun:yes'>                  </span>&lt;dir&gt; &lt;type&gt;<span style='mso-spacerun:yes'>   </span>&lt;options&gt;<span style='mso-spacerun:yes'>           </span>&lt;dump&gt; &lt;pass&gt;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>192.168.1.100:/diskless<span style='mso-spacerun:yes'>          </span>/<span style='mso-spacerun:yes'>     </span>nfs4<span style='mso-spacerun:yes'>     </span>defaults,noatime<span style='mso-spacerun:yes'>    </span>0<span style='mso-spacerun:yes'>      </span>0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/srv/new_root/srv/source_usr.sfs /usr<span style='mso-spacerun:yes'>  </span>squashfs loop,compress=xz<span style='mso-spacerun:yes'>    </span>0<span style='mso-spacerun:yes'>      </span>0</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
На позднем этапе работы initramfs монтированием папки /usr занимается
обработчик usr, который нужно немного подправить:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cp </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/{usr/lib,etc}/initcpio/install/usr &amp;&amp; cp </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/{usr/lib,etc}/initcpio/hooks/usr</span></code><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Нужно, чтобы строка монтирования выглядела так:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/initcpio/hooks/usr<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>mount </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;/new_root</span></span><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$usr_source</span></span><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> /new_root/usr -o </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$mountopts</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>Чем</span><span style='font-family:"Arial",sans-serif;
color:#548EAA;mso-ansi-language:EN-US'> </span><span style='font-family:"Arial",sans-serif;
color:#548EAA'>не</span><span style='font-family:"Arial",sans-serif;color:#548EAA;
mso-ansi-language:EN-US'> </span><span style='font-family:"Arial",sans-serif;
color:#548EAA'>устраивает</span><span lang=EN-US style='font-family:"Arial",sans-serif;
color:#548EAA;mso-ansi-language:EN-US'> usr?</span><span lang=EN-US
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br style='mso-special-character:
line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cat </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/mkinitcpio.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>HOOKS=</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;base udev net_nfs4 live usr&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> mkinitcpio -p habr</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-size:
12.0pt;line-height:107%;font-family:"Arial",sans-serif;color:#222222;
mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#548EAA'>nfs4+live+squashed /usr</span><span style='font-family:"Arial",sans-serif;
color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Данных пришлось передать примерно на 20% меньше, чем в предыдущий раз. Можно
упаковать весь корневой каталог в один файл, тогда обработчик live для
заполнения ramfs будет забирать с сервера данные в сжатом виде.&nbsp;<br>
<br>
Можно скопировать файл /srv/source_usr.sfs в ramfs поменяв правила в фильтре
rsync, а потом примонтировать его через fstab из нового места, и, когда вся
система целиком окажется в RAM, попробовать отключиться от загрузочного
сервера.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h3 style='margin-top:0cm;line-height:21.0pt;background:white'><b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'>Убираем лишнее</span></b><span
style='font-size:15.0pt;font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></h3>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Если вы заглядывали&nbsp;<a
href="https://wiki.archlinux.org/index.php/Diskless_system"><span
style='color:#992298'>сюда</span></a>, то у вас не возникнет вопрос: «Как мы
будем отдавать с сервера файл?». Можно, конечно, передавать данные squashfs
посредством NFS (что и происходило выше), но существует менее документированное
решение&nbsp;<a href="http://en.wikipedia.org/wiki/Network_block_device"><span
style='color:#992298'>Network Block Device</span></a>, с которым можно работать
как с обычным диском. Поскольку это «блочное устройство», а не «файловая
система», мы можем использовать на нём любую файловую систему с возможностью
сжатия данных. Для доступа на чтение и запись подойдёт btrfs с архивацией zlib,
но нам не нужна запись и squashfs вполне устраивает.<br>
<br>
Чтобы из initramfs можно было подключиться к NBD-серверу при загрузке
понадобится скачать из AUR пакет mkinitcpio-nbd (нужно скачивать и собирать с
правами обычного пользователя):<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>curl -o mkinitcpio-nbd.tar.gz https://aur.archlinux.org/packages/mk/mkinitcpio-nbd/mkinitcpio-nbd.tar.gz<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>tar -xvvzf mkinitcpio-nbd.tar.gz<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-builtin><span
style='font-size:10.5pt;color:#C18401;background:#FBFDFF'>cd</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> mkinitcpio-nbd<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>makepkg -s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>sudo pacman --root </span></code><span
class=hljs-variable><span style='font-size:10.5pt;color:#986801;background:
#FBFDFF'>$root</span></span><code><span style='font-size:10.5pt;color:#383A42;
background:#FBFDFF'> --dbpath </span></code><span class=hljs-variable><span
style='font-size:10.5pt;color:#986801;background:#FBFDFF'>$root</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>/var/lib/pacman -U mkinitcpio-nbd-0.4.2-1-any.pkg.tar.xz</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Добавляем в конец файла $root/boot/grub/grub.cfg новый пункт меню:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cat </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/boot/grub/grub.cfg<o:p></o:p></span></code></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>menuentry </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;NBD&quot;</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> {<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span>load_video<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>set</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> gfxpayload=keep<o:p></o:p></span></code></pre><pre style='background:
white;word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>insmod gzio<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>echo</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><span class=hljs-string><span style='font-size:10.5pt;
color:#50A14F;background:#FBFDFF'>Загружается</span></span><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US'> </span></span><span class=hljs-string><span
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>ядро</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>...&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>linux vmlinuz-linux \<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>         </span>add_efi_memmap \<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>         </span>ip=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$net_default_ip</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>:</span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$net_default_server</span></span><span class=hljs-string><span
lang=EN-US style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>:192.168.1.1:255.255.255.0::eth0:none \<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>         </span>nbd_host=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$net_default_server</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> nbd_name=habrahabr root=/dev/nbd0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>echo</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;</span></span><span class=hljs-string><span style='font-size:10.5pt;
color:#50A14F;background:#FBFDFF'>Загружается</span></span><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US'> </span></span><span class=hljs-string><span
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>виртуальный</span></span><span
class=hljs-string><span style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;
mso-ansi-language:EN-US'> </span></span><span class=hljs-string><span
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF'>диск</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>...&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>initrd initramfs-linux.img<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>}</span></code><span style='font-size:
12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Как видите, поменялась только одна строчка:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nbd_host=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$net_default_server</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> nbd_name=habrahabr root=/dev/nbd0</span></code><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
После подключения к NBD серверу в клиенте появляется блочное устройство с
именем /dev/nbd0, поэтому поступаем с ним как с обычным диском:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/fstab<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
lang=EN-US style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'># &lt;file system&gt;<span style='mso-spacerun:yes'>            </span>&lt;dir&gt;<span style='mso-spacerun:yes'>  </span>&lt;type&gt;<span style='mso-spacerun:yes'>    </span>&lt;options&gt;<span style='mso-spacerun:yes'>           </span>&lt;dump&gt; &lt;pass&gt;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>/dev/nbd0<span style='mso-spacerun:yes'>                  </span>/<span style='mso-spacerun:yes'>      </span>squashfs<span style='mso-spacerun:yes'>  </span>ro,loop,compress=xz 0<span style='mso-spacerun:yes'>      </span>0</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
В последних версиях NBD сервера появилась непрятная особенность (скорее всего
это баг). Когда клиент NBD устанавливает соединение с сервером, а потом
внезапно выключается не завершая соединение корректно, и оно продолжает
«болтаться» на сервере в виде незавершенного процесса. Если клиент во время
загрузки попробует подключиться к NBD заново, то есть вероятность, что сервер
не станет создавать новое соедиенение считая старое активным. Предлагаю
непосредственно перед подключением к NBD отправлять свой IP адрес через netcat
на сервер, чтобы тот закрыл старые подключения, связанные с этим IP адресом:&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cp </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/{usr/lib,etc}/initcpio/install/nbd<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>cp </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$root</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>/{usr/lib,etc}/initcpio/hooks/nbd</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Нужно отредактировать только один файл. Вставьте между строками следующий
фрагмент:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/initcpio/hooks/nbd<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>                </span></span></code><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'>modprobe nbd </span></code><span
class=hljs-comment><i><span style='font-size:10.5pt;color:#A0A1A7;background:
#FBFDFF'># вставляете после этой строки</span></i></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>                </span></span></code><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>msg </span></code><span class=hljs-string><span lang=EN-US
style='font-size:10.5pt;color:#50A14F;background:#FBFDFF;mso-ansi-language:
EN-US'>&quot;closing old connections...&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>                </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>echo</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>${ip}</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> | nc </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${nbd_host}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> 45678<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>                </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>local</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> ready=$(nc -l -p 45678)<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>                </span>[ </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$ready</span></span><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> -ne 1 ] &amp;&amp; reboot<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>                </span>msg </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;connecting...&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-comment><i><span style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF'># и перед этой строкой</span></i></span><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
В initramfs сетью по-прежнему заведует наш модифицированный net_nfs4, после
которого вставляем nbd:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/etc/mkinitcpio.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>MODULES=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;loop squashfs&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>HOOKS=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;base udev net_nfs4 keyboard nbd live&quot;</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Генерируем</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> initramfs:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>arch-chroot </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> mkinitcpio -p habr</span></code><span lang=EN-US style='font-size:12.0pt;
color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Перед выполнением следующей команды удалите или переместите файл
$root/srv/source_usr.sfs за пределы $root — не имеет смысла помещать архив /usr
внутрь архива, содержащего оригинал /usr:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mksquashfs </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/* /srv/new_root.sfs -b 4096 -comp xz</span></code><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Переходим к настройке сервера<br>
<br>
Устанавливаем пакет:<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S nbd</span></code><span style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Настраиваем NBD сервер:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mv /etc/nbd-server/{config,config.old} &amp;&amp; nano /etc/nbd-server/config<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>[generic]<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span>user = nbd<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span>group = nbd<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>[habrahabr]<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span><span style='mso-spacerun:yes'>    </span>exportname = /srv/new_root.sfs<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span>timeout = 30<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>readonly</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> = </span></code><span class=hljs-literal><span lang=EN-US
style='font-size:10.5pt;color:#0184BB;background:#FBFDFF;mso-ansi-language:
EN-US'>true</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span>multifile = </span></code><span
class=hljs-literal><span lang=EN-US style='font-size:10.5pt;color:#0184BB;
background:#FBFDFF;mso-ansi-language:EN-US'>false</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>        </span>copyonwrite = </span></code><span
class=hljs-literal><span lang=EN-US style='font-size:10.5pt;color:#0184BB;
background:#FBFDFF;mso-ansi-language:EN-US'>false</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Всё достаточно просто. Мы создаём шару с именем habrahabr, ссылаемся на наш
файл, устанавливаем таймаут соединения, раздаём в режиме «только для чтения»,
отдаём только один файл и функция copyonwrite нам не нужна. Copyonwrite
позволяет использовать одну и ту же раздачу несколькими клиентами одновременно,
при этом каждому клиенту создаётся отдельный файл, куда будут записываться все
произведённые им изменения оригинального файла. После отключения клиента файлы
с изменениями удаляются автоматически. Использование этой функции замедляет
сервер. Информации по NBD в интернете не так много, но man'ы решают.<br>
<br>
Проверять и завершать процессы, связанные с незакрытыми соединениями будет вот
этот файл:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano /etc/default/close_passive_NBD_connections.sh<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><span class=hljs-meta><span style='font-size:10.5pt;
color:#4078F2;background:#FBFDFF'>#!/bin/sh</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF'># завершает все процессы с полученными PID</span></i></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-title><span
lang=EN-US style='font-size:10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:
EN-US'>_kill</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>(){<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>local</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> PID<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-keyword><span lang=EN-US style='font-size:10.5pt;color:#A626A4;
background:#FBFDFF;mso-ansi-language:EN-US'>for</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> PID </span></code><span class=hljs-keyword><span lang=EN-US
style='font-size:10.5pt;color:#A626A4;background:#FBFDFF;mso-ansi-language:
EN-US'>in</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> $*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>        </span></span></code><span
class=hljs-keyword><span lang=EN-US style='font-size:10.5pt;color:#A626A4;
background:#FBFDFF;mso-ansi-language:EN-US'>do</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> </span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>kill</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$PID</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span></span></code><span
class=hljs-keyword><span lang=EN-US style='font-size:10.5pt;color:#A626A4;
background:#FBFDFF;mso-ansi-language:EN-US'>done</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>}<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-title><span
lang=EN-US style='font-size:10.5pt;color:#4078F2;background:#FBFDFF;mso-ansi-language:
EN-US'>main</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>(){<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> <span style='mso-spacerun:yes'>   </span></span></code><span
class=hljs-builtin><span style='font-size:10.5pt;color:#C18401;background:#FBFDFF'>local</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> rIP PIDs<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-tab-count:1'>        </span></span></code><span
class=hljs-comment><i><span style='font-size:10.5pt;color:#A0A1A7;background:
#FBFDFF'># нам передают с клиента значение переменной ip из параметров ядра в grub.cfg</span></i></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span></span></code><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>rIP=$(netcat -l -p 45678 | cut -d: -f1)<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-tab-count:1'>        </span></span></code><span
class=hljs-comment><i><span style='font-size:10.5pt;color:#A0A1A7;background:
#FBFDFF'># фильтруем пакеты с полученного IP адреса и узнаём их PID</span></i></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>    </span></span></code><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>PIDs=$(netstat -np | grep </span></code><span class=hljs-variable><span
lang=EN-US style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$rIP</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> | awk </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>'/^tcp.*nbd-server/{split($NF,a,&quot;/&quot;);print a[1]}'</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>)<o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>    </span>_kill </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$PIDs</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> &amp;&amp; </span></code><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>echo</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;1&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> | netcat -z </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>$rIP</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> 45678<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>}<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF'># повторяем в бесконечном цикле</span></i></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-keyword><span
style='font-size:10.5pt;color:#A626A4;background:#FBFDFF'>while</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> [ 0 ]<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-keyword><span
style='font-size:10.5pt;color:#A626A4;background:#FBFDFF'>do</span></span><code><span
style='font-size:10.5pt;color:#383A42;background:#FBFDFF'> main<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-keyword><span
style='font-size:10.5pt;color:#A626A4;background:#FBFDFF'>done</span></span><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Файл делаем исполняемым:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>chmod +x /etc/default/close_passive_NBD_connections.sh</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Устанавливаем пакеты, в которых находятся утилиты netcat и netstat:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>pacman -S gnu-netcat net-tools</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Модифицируем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>запуск</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>службы</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> NBD:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mkdir -p /etc/systemd/system/nbd.service.d &amp;&amp; nano /etc/systemd/system/nbd.service.d/close_passive.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>[Service]<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>Type=oneshot<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>ExecStart=/etc/default/close_passive_NBD_connections.sh</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='margin-bottom:12.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222'><br>
Возможно, выбрано не самое изящное решение, но оно достаточно понятно и
замечательно работает.</span><span style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;background:
white'><span style='font-family:"Arial",sans-serif;color:#548EAA'>nbd +
squashed live</span><span style='font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
На этот раз мы сэкономили ещё всего лишь 3% трафика (в пределах погрешности).
Разница во времени загрузки объясняется тем, что при использовании NFS перед
подключением к серверу делается принудительная пауза в 10 секунд, а в случае
сервера NBD такой задержки нет.<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Педаль
в пол<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Давайте попробуем ускорить загрузку. Самое слабое звено в нашей цепочке
загрузки — TFTP сервер. Полностью исключить его мы не сможем, но минимизировать
его присутствие можно с помощью загрузчика&nbsp;<a href="http://ipxe.org/"><span
style='color:#992298'>iPXE</span></a>, как посоветовал&nbsp;<a
href="http://habrahabr.ru/users/kvaps/" style='display:inline-block'><span
style='color:#992298'>kvaps</span></a>&nbsp;в комментариях к предыдущей статье.<br>
<br>
Подключитесь к загрузочному серверу под именем username.<br>
<br>
Меню с вариантами загрузки мы делать не будем, а автоматически загрузимся в
самый быстрый на текущий момент:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano ~/myscript.ipxe<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><span class=hljs-comment><i><span lang=EN-US
style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'>#!ipxe</span></i></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>ifopen net0<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><span class=hljs-builtin><span lang=EN-US
style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>set</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> server_ip 192.168.1.100<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>set</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> http_path http://</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${server_ip}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;
color:#C18401;background:#FBFDFF;mso-ansi-language:EN-US'>set</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> kern_name vmlinuz-linux<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>kernel </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${http_path}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/</span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>${kern_name}</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> || </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>read</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> void<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>initrd </span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${http_path}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/initramfs-linux.img || </span></code><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>read</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> void<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>imgargs </span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>${kern_name}</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> add_efi_memmap ip=</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${net0/ip}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>:</span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>${server_ip}</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>:</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${net0/gateway}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>:</span></code><span class=hljs-variable><span lang=EN-US
style='font-size:10.5pt;color:#986801;background:#FBFDFF;mso-ansi-language:
EN-US'>${net0/netmask}</span></span><code><span lang=EN-US style='font-size:
10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>::eth0:none nbd_host=</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>${server_ip}</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> nbd_name=habrahabr root=/dev/nbd0 || </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>read</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> void<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>boot || </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>read</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> void</span></code><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Мы</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>планируем</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>получать</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>файлы</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> vmlinuz-linux </span><span style='font-family:"Arial",sans-serif;
color:#222222'>и</span><span lang=EN-US style='font-family:"Arial",sans-serif;
color:#222222;mso-ansi-language:EN-US'> initramfs </span><span
style='font-family:"Arial",sans-serif;color:#222222'>по</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>протоколу</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'> HTTP. </span><span style='font-family:"Arial",sans-serif;color:#222222'>Внедрим</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>наш</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>скрипт</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>в</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>загрузчик</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'>:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>sudo pacman -S git &amp;&amp; git </span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>clone</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> git://git.ipxe.org/ipxe.git<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>cd</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'> ipxe/src/<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>make bin/undionly.kpxe EMBED=/home/username/myscript.ipxe</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Возвращаемся в root на сервере и копируем загрузчик:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>cp {/home/username/ipxe/src/bin,</span></code><span
class=hljs-variable><span lang=EN-US style='font-size:10.5pt;color:#986801;
background:#FBFDFF;mso-ansi-language:EN-US'>$root</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/boot}/undionly.kpxe</span></code><span lang=EN-US style='font-size:
12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Исправим DHCP сервер таким образом, чтобы он предлагал скачивать новый файл:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano /etc/dhcpd.conf<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><span class=hljs-comment><i><span
lang=EN-US style='font-size:10.5pt;color:#A0A1A7;background:#FBFDFF;mso-ansi-language:
EN-US'>#if option architecture = 7 {</span></i></span><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># filename &quot;/grub/x86_64-efi/core.efi&quot;;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># } else {</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'># filename &quot;/grub/i386-pc/core.0&quot;;</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><span class=hljs-comment><i><span lang=EN-US style='font-size:10.5pt;
color:#A0A1A7;background:#FBFDFF;mso-ansi-language:EN-US'>#}</span></i></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>filename </span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;/undionly.kpxe&quot;</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>;<o:p></o:p></span></code></pre><pre style='background:white;word-break:
break-all'><code><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>systemctl restart dhcpd4</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Устанавливаем HTTP сервер:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>pacman -S apache</span></code><span style='font-size:12.0pt;
color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
привязываем папку с загрузчиком к рабочей папки сервера:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mount --</span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>bind</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> /srv/nfs/diskless/boot/ /srv/http/</span></code><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Можно перемонтировать в режим «только для чтения»:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>mount -o remount,ro,</span></code><span
class=hljs-builtin><span lang=EN-US style='font-size:10.5pt;color:#C18401;
background:#FBFDFF;mso-ansi-language:EN-US'>bind</span></span><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'> /srv/nfs/diskless/boot/ /srv/http/</span></code><span lang=EN-US
style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Запускаем сервер:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>systemctl start httpd</span></code><span style='font-size:12.0pt;
color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Смотрим, что происходит на сервере:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>vnstat -l<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>...<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>                            </span>rx<span style='mso-spacerun:yes'>         </span>|<span style='mso-spacerun:yes'>       </span>tx<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>--------------------------------------+------------------<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>  </span>bytes<span style='mso-spacerun:yes'>                     </span>1,50 MiB<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>      </span>206,73 MiB<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>--------------------------------------+------------------<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>          </span>max<span style='mso-spacerun:yes'>            </span>2,96 Mbit/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>   </span>191,95 Mbit/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>      </span>average<span style='mso-spacerun:yes'>          </span>684,08 kbit/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>    </span>94,08 Mbit/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>          </span>min<span style='mso-spacerun:yes'>  </span><span style='mso-spacerun:yes'>             </span>5 kbit/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>        </span>1 kbit/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>--------------------------------------+------------------<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>  </span>packets<span style='mso-spacerun:yes'>                      </span>22762<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>           </span>90737<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>--------------------------------------+------------------<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>          </span>max<span style='mso-spacerun:yes'>               </span>5735 p/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>    </span><span style='mso-spacerun:yes'>    </span>9871 p/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>      </span>average<span style='mso-spacerun:yes'>               </span>1264 p/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>        </span>5040 p/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><span style='mso-spacerun:yes'>          </span>min<span style='mso-spacerun:yes'>                  </span>3 p/s<span style='mso-spacerun:yes'>  </span>|<span style='mso-spacerun:yes'>           </span>1 p/s<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'>--------------------------------------+------------------<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><span style='mso-spacerun:yes'>  </span>time<span style='mso-spacerun:yes'>                    </span>18 seconds</span></code><span
style='font-size:12.0pt;color:#222222'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
<br>
Выигрыш в скорости загрузки от замены TFTP на HTTP заметен невооружённым глазом
и это не единственный примечательный момент iPXE. Например,&nbsp;<a
href="https://releng.archlinux.org/pxeboot/"><span style='color:#992298'>здесь</span></a>&nbsp;показано,
как можно прямо во время загрузки выбрать сервер с официальным образом
установочной флешки и загрузиться в него прямо через Интернет без необходимости
предварительного скачивания. Уверен, что теперь вы сможете повторить то же
самое и со своим образом.&nbsp;<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<h2 style='margin:0cm;margin-bottom:.0001pt;line-height:24.0pt;background:white'><span
style='font-family:"Arial",sans-serif;color:#222222;font-weight:normal'>Возвращаемся
на сервер<o:p></o:p></span></h2>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
Попробуйте добавить обработчик live в наш загрузочный сервер. Сейчас правила
rsync пропускают копирование содержимого /srv, где у нас находятся файлы
клиента. Мы можем поменять правила или примонтировать директорию с помощью
systemd:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>nano /etc/fstab<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'><o:p>&nbsp;</o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>LABEL=HABR<span style='mso-spacerun:yes'>        </span>/<span style='mso-spacerun:yes'>    </span>ext4 rw,relatime,data=ordered 0 1<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>/srv/new_root/srv /srv none </span></code><span class=hljs-builtin><span
lang=EN-US style='font-size:10.5pt;color:#C18401;background:#FBFDFF;mso-ansi-language:
EN-US'>bind</span></span><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'><span style='mso-spacerun:yes'>                     </span>0 1</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
В данном случае папки /srv/new_root/srv и /srv связываются в режиме полного
доступа на чтение и запись, но мы знаем решения.<br>
<br>
Тот факт, что загрузочный сервер может работать в режиме «только для чтения»,
будет весьма полезен для систем, установленных на недорогую USB флешку. С
такого накопителя лучше побольше читать, и поменьше на него записывать. Если вы
откроете его в интернет, то получите дополнительную степень защиты. Например,
роутер открывает защищенный VPN канал, на другом конце которого находится
загрузочный сервер…<br>
<br>
Чтобы переписать систему на флешку (с жёстким диском принцип тот же самый), её
нужно вставить в компьютер и подключить к VirtualBox (Меню Устройства &gt;
Устройства USB и выбрать нужную из списка). Список доступных блочных устройств
проверяется командой lsblk, как в самой&nbsp;<a
href="http://habrahabr.ru/post/253256/"><span style='color:#992298'>первой
статье</span></a>. Разметьте флешку пометив загрузочной, отформатируйте с той
же меткой HABR и примонтируйте к /mnt.<br>
<br>
Создадим новый файл с правилами для rsync:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'>nano /root/clone_filter<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span style='font-size:
10.5pt;color:#383A42;background:#FBFDFF'><o:p>&nbsp;</o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /boot/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>+ /etc/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /home/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>+ /srv/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>+ /usr/*<o:p></o:p></span></code></pre><pre style='background:white;
word-break:break-all'><code><span lang=EN-US style='font-size:10.5pt;
color:#383A42;background:#FBFDFF;mso-ansi-language:EN-US'>+ /var/*<o:p></o:p></span></code></pre><pre
style='background:white;word-break:break-all'><code><span lang=EN-US
style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>- /*/*</span></code><span lang=EN-US style='font-size:12.0pt;color:#222222;
mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Дождитесь</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>выполнения</span><span
style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'> </span><span
style='font-family:"Arial",sans-serif;color:#222222'>команды</span><span
lang=EN-US style='font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:
EN-US'>:<br>
<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span lang=EN-US style='font-size:12.0pt;line-height:107%;
font-family:"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span lang=EN-US style='font-size:10.5pt;color:#383A42;
background:#FBFDFF;mso-ansi-language:EN-US'>rsync -aAXv /* /mnt --filter=</span></code><span
class=hljs-string><span lang=EN-US style='font-size:10.5pt;color:#50A14F;
background:#FBFDFF;mso-ansi-language:EN-US'>&quot;merge /root/clone_filter&quot;</span></span><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span style='font-family:"Arial",sans-serif;
color:#222222'><br>
В моём случае флешка — /dev/sdb<br style='mso-special-character:line-break'>
<![if !supportLineBreakNewLine]><br style='mso-special-character:line-break'>
<![endif]></span><span style='font-size:12.0pt;line-height:107%;font-family:
"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<pre style='background:white;word-break:break-all'><code style='overflow-x: auto;
white-space:pre-wrap'><span style='font-size:10.5pt;color:#383A42;background:
#FBFDFF'><span style='mso-spacerun:yes'> </span></span></code><code><span
lang=EN-US style='font-size:10.5pt;color:#383A42;background:#FBFDFF;mso-ansi-language:
EN-US'>arch-chroot /mnt grub-install --target=i386-pc --force --recheck /dev/sdb</span></code><span
lang=EN-US style='font-size:12.0pt;color:#222222;mso-ansi-language:EN-US'><o:p></o:p></span></pre>

<p class=MsoNormal style='background:white'><span lang=EN-US style='font-family:
"Arial",sans-serif;color:#222222;mso-ansi-language:EN-US'><br>
</span><span style='font-family:"Arial",sans-serif;color:#222222'>Остаётся
отмонтировать /mnt и можно загружаться из копии.<br>
<br>
PS Решение разрабатывалось для автоматизации компьютерных классов. Система
одинаково работает на пожертвованных и новых компьютерах с самыми
разнообразными конфигурациями. Восстановление системы на клиенте к
первоначальному состоянию производится обычной перезагрузкой. Нужные данные можно
сохранять на диске загрузочного сервера или на любом другом сетевом или
локальном накопителе.<br>
<br>
Поделитесь своими идеями применения.</span><span style='font-size:12.0pt;
line-height:107%;font-family:"Arial",sans-serif;color:#222222'><o:p></o:p></span></p>

<p class=MsoNormal style='background:white'><b><span style='font-size:10.5pt;
line-height:107%;font-family:"Arial",sans-serif;color:#444444'>Теги:<o:p></o:p></span></b></p>

<ul style='margin-top:0cm;display:flex;flex-wrap: wrap;align-items: flex-start'
 type=disc>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5B%D0%BD%D0%BE%D0%B2%D0%B8%D1%87%D0%BA%D0%B0%D0%BC%5D&amp;target_type=posts"><span
     style='color:#548EAA'>новичкам</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Budev%5D&amp;target_type=posts"><span
     style='color:#548EAA'>udev</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bnbd%5D&amp;target_type=posts"><span
     style='color:#548EAA'>nbd</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bnfsv4%5D&amp;target_type=posts"><span
     style='color:#548EAA'>nfsv4</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Btftp%5D&amp;target_type=posts"><span
     style='color:#548EAA'>tftp</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Bipxe%5D&amp;target_type=posts"><span
     style='color:#548EAA'>ipxe</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Brsync%5D&amp;target_type=posts"><span
     style='color:#548EAA'>rsync</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5B%D1%83%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0%20linux%5D&amp;target_type=posts"><span
     style='color:#548EAA'>установка linux</span></a><o:p></o:p></span></li>
 <li class=MsoNormal style='color:#333333;margin-bottom:0cm;margin-bottom:.0001pt;
     line-height:normal;mso-list:l4 level1 lfo12;tab-stops:list 36.0pt;
     background:white'><span style='font-size:10.5pt;font-family:"Arial",sans-serif'><a
     href="https://habr.com/ru/search/?q=%5Binitramfs%5D&amp;target_type=posts"><span
     style='color:#548EAA'>initramfs</span></a><o:p></o:p></span></li>
</ul>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='margin-bottom:0cm;margin-bottom:.0001pt;text-indent:
21.3pt;line-height:150%'><span style='font-size:12.0pt;line-height:150%;
font-family:"Times New Roman",serif'><o:p>&nbsp;</o:p></span></p>

</div>

</body>

</html>
